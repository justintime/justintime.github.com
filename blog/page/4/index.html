
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>SysAdmin's Journey</title>
  <meta name="author" content="Justin Ellison">

  
  <meta name="description" content="Contrary to the lack of posts on my blog, I&#8217;m still alive. I apologize for not
writing much, but things have been so busy lately. At $work, I&# &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sysadminsjourney.com/blog/page/4/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="SysAdmin's Journey" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-5430710-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">SysAdmin's Journey</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sysadminsjourney.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/contact">Contact</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/11/11/im-not-dead-yet">I&#8217;m Not Dead Yet!!!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-11T00:00:00-06:00" pubdate data-updated="true">Nov 11<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Contrary to the lack of posts on my blog, I&#8217;m still alive. I apologize for not
writing much, but things have been <strong>so</strong> busy lately. At $work, I&#8217;m working
on rolling out a forklift upgrade in a lab environment that involves:</p>

<ul>
<li>Upgrade our application servers from Solaris 9 to Solaris 10.</li>
<li>Upgrade Java from 1.4.2 to 5. Yes, I know that 5 is already EOL, but our API vendor runs on Weblogic 9, which is constrained to Java 5.</li>
<li>Speaking of Weblogic, upgrade that from 8.1 to 9.2.</li>
<li>Upgrade our ecommerce API from version 6.x to 10.x</li>
<li>Upgrade our Apache frontends from 2.0 to 2.2 - Done!</li>
<li>Implement a couple of Nginx boxes as a static HTTP servers, allowing our Apache servers to focus proxying and URL rewriting.
All of this of course needs to happen in parallel with the normal firefighting
;-) Oh, and I&#8217;m trying to get
<a href="http://reductivelabs.com/products/puppet/">Puppet</a> up and running in the lab
in all my free time. On the other hand at $home, I&#8217;ve been doing a lot of work
with <a href="http://www.drupal.org">Drupal</a>. I&#8217;m working on designing a photography
site for a friend. Heck, I&#8217;ve even had some code committed to <a href="http://www.drupal.org/project/node_gallery">the node
gallery contrib module</a>! I&#8217;ve got
two books I&#8217;ve yet to crack open, <a href="http://www.amazon.com/gp/product/0596153287?ie=UTF8&amp;tag=sysajour-20&amp;linkCode=a%0As2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=0596153287">Mac OS X Snow Leopard: The Missing Manual</a>, and <a href="http://www.amazon.com/gp/product/1430209895?ie=UTF8&amp;tag=sysajour-20&amp;link%0ACode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=1430209895">Pro Drupal Develop
ment</a>. I&#8217;m trying to
read through <a href="http://progit.org/book/ch3-2.html">Pro Git</a>, and <a href="http://www.amazon.com/gp/product/1590599780?ie=UTF8&amp;tag=s%0Aysajour-20&amp;linkCode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=1590599780">Pulling
Strings with Puppet</a>.
All of this productivity came to a screeching halt last Friday, when I got my
<a href="http://verizonwireless.com/droid">Motorola Droid</a>. The best part about my HTC
running Windows Mobile was that it kept me in the dark about how fricking cool
a real smartphone can be! As part of my new addiction to my phone, I caved in
and signed up for a Facebook account &#8211; don&#8217;t worry, I didn&#8217;t give them my
email password, so no one will get any spam. Feel free to <a href="https://register.facebook.com/justin.d.ellison">hit me
up</a> though! I have to admit,
the sheer number of users is impressive; but it&#8217;s the percentage of those that
are actively using it every day that is incredible. So, stay tuned. There&#8217;s a
lot of good posts coming - book reviews, a Droid/Android review (with an SA
POV of course), and who knows, maybe some Drupal related stuff.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/10/15/checkpoint-utm-1-vs-cisco-asa-ecommerce-setting">CheckPoint UTM-1 vs Cisco ASA in an ECommerce Setting</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-15T00:00:00-05:00" pubdate data-updated="true">Oct 15<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/assets/images/cisco-logo.gif" alt="" />Recently at $WORK, we had to come up with
budget proposals for next year. We knew that we were going to outgrow our
current Checkpoint UTM appliances by holiday next year, so we had to buy new
hardware. We just had to decide which hardware. While I&#8217;m capable of building
a Linux/*BSD firewall on my own, I frankly don&#8217;t have the time to mess around
with updates and compliance documentation. We need an appliance, and for our
needs, Cisco and CheckPoint are about the only options for us. We switched to
the UTM appliances from a pair of Cisco ASA 5500&#8217;s a few years ago. However,
after examining the pros and cons of both, I recommended we switch back to the
ASA platform next year. Read on for my decision making process explained.</p>

<p>Our first experience with the ASA product line from Cisco was a few years ago.
The current ASA software at the time was 5.x (IIRC, maybe it was 6.x). The
reason we switched to CheckPoint and their UTM-1 appliances was due to the
lack of configurability. First of all, it was very tricky to make the ASA
behave like a router AND a firewall, not just a firewall. Eventually, they
supported the features necessary to do basic static routing, but I hit an
issue where the &#8220;ASP&#8221; or &#8220;Accelerated Security Path&#8221; filters on the ASA were
throwing away packets that I didn&#8217;t want it to. I was unable to write an ACL
or tweak a configuration that would let the packets I needed to get through.
In essence, the firewall was saying it knew what was bad for me, and wouldn&#8217;t
listen to my argument on the matter at all. After going round-n-round with
Cisco TAC, it became my sole purpose in life to get rid of those damned ASA&#8217;s.
I succeeded in that two months later with a pair of UTM-1&#8217;s from CheckPoint.</p>

<p>We&#8217;re in the minority of businesses where our firewall&#8217;s priority isn&#8217;t
protecting internal users from the big, bad Internet. Our goal is to let all
but the most blatantly abusive potential guests browse our website and buy
stuff. This is an important distinction - if we were the typical corporate
network that focused on the former, we probably would have stuck with
CheckPoint. So, here&#8217;s my list of pros and cons for each device:</p>

<ul>
<li><h2><strong>CheckPoint</strong></h2>

<ul>
<li><p><strong>Pros</strong></p>

<ul>
<li><p>SmartView Tracker. This app has no competition that I&#8217;ve found. This app lets you view events in real time, or do some pretty complex searches in real time. Beats the heck out of grep | cut | sort | uniq | wc on a syslog file.</p></li>
<li><p>SmartDashboard: If you&#8217;re into GUI&#8217;s, this one is very nice at configuring rulesets, and giving you a graphical view of your networks.</p></li>
<li><p>SmartDefense: while quite expensive, this L7 deep inspection filter does it&#8217;s job well. You get updates every week or so, and can turn them on, off, or put them in monitor mode which lets the packets through, but logs an event. This allows you to see what would happen if you turned it on, without actually interrupting packet flow.</p></li>
</ul>
</li>
<li><p><strong>Cons</strong></p>

<ul>
<li><p>Expense. Yikes. Comparing a Cisco ASA solution to the closest CheckPoint solution in our case has CheckPoint coming in at more than 25% more than the Cisco which will push more pps.</p></li>
<li><p>Lack of a robust CLI. This is a killer for me. While having a GUI can be nice at times, nothing beats a concise CLI. Where Cisco&#8217;s ASDM solution is a GUI built upon a CLI foundation, CheckPoint&#8217;s CLI is an afterthought to the GUI. Some might argue there&#8217;s nothing you can&#8217;t do via the CLI on a CheckPoint, but if you&#8217;re editing the policy files in vi, then you&#8217;re just asking for trouble.</p></li>
<li><p>Commodity hardware. CheckPoint is a software solution, and their UTM-1 appliances are nothing more than x86 boxes running SecurePlatform (which is a pared down RHEL). While there&#8217;s nothing inherently wrong with that, the result of CheckPoint using off-the-shelf hardware versus Cisco&#8217;s custom hardware is that Cisco&#8217;s can push a lot more packets than comparable CheckPoints.</p></li>
<li><p>Hard Drives. Cisco&#8217;s run off flash and have no moving parts save for the fans. CheckPoint&#8217;s appliance requires a full-on hard drive. While I&#8217;ve had DOA Cisco flash, I&#8217;ve never had their flash fail me once put into service. I can&#8217;t count how many hard drives have failed me over the years.</p></li>
<li><p>Reliance upon a SmartCenter server. Some may see this as a positive, but I see it as a negative. When you install your CheckPoint policy, it first goes to a separate server called the SmartCenter. The SmartCenter then pushes this config to the individual appliances one-by-one. All logs on the appliances are sent to the SmartCenter. I have a few problems with this. First, it&#8217;s another server. Second, it&#8217;s another single point of failure &#8211; if your SmartCenter dies, you lose the ability to change the configuration on your appliances until you get it back up. To eliminate the single point of failure, you&#8217;re encouraged to run a Active/Standby HA setup of SmartCenter. At this point, you have not just two appliances to keep up to date, but two SmartCenter servers as well. Each one of these devices is an x86 box with a hard drive, so MTBF is comparitively low.</p></li>
</ul>
</li>
</ul>
</li>
<li><h2><strong>Cisco</strong></h2>

<ul>
<li><p><strong>Pros</strong></p>

<ul>
<li><p>CLI. While it&#8217;s not quite IOS, it&#8217;s damn close, and anyone at home in IOS can pick up the ASA differences very quickly.</p></li>
<li><p>Easy upgrades and rollbacks. Cisco&#8217;s software upgrades might be odd to some, but once you get the hang of it, you won&#8217;t find anything better.</p></li>
<li><p>Optimized hardware. With the ASA&#8217;s, you get very few moving parts and ASIC&#8217;s that are optimized for pushing packets. Cisco&#8217;s been doing this for a long time, and they&#8217;re very good at it.</p></li>
<li><p>More bang for the buck. You pay less for a Cisco solution that has higher specs than a CheckPoint solution that doesn&#8217;t do as much.</p></li>
<li><p>ASDM. If you&#8217;re into the GUI thing, you can not ever have to touch the CLI.</p></li>
</ul>
</li>
<li><p><strong>Cons</strong></p>

<ul>
<li><p>Bugs. Cisco&#8217;s everything-including-the-kitchen-sink mindset means that their software tends to have a lot more bugs in it than what I&#8217;ve seen with CheckPoint. In their defense, Cisco seems to have been pretty quick to fix the bugs that I&#8217;ve encountered.</p></li>
<li><p>VPN Policy Management. I can&#8217;t speak to this too much, as I never really used the VPN portion of either appliance. However, it was plain to see that CheckPoint had a lot more to offer in their solution when it came to VPN policy management features.</p></li>
</ul>
</li>
</ul>
</li>
</ul>


<p>I&#8217;m sure there&#8217;s a lot that I missed, but in the end, it came down to a few
major points. Cisco has incremented their software 3 major versions since my
last production experience with them, and it seems to me that much of the
reason why I switched away has been resolved. I feel much more at home using
the IOS-like CLI. I didn&#8217;t need a lot of the extra features that CheckPoint
offered. Last, but certainly not least, there&#8217;s a lot more fun things I can
spend that 25% on like new servers! However, if I had a bunch of business
users to extend VPN functionality to, while making sure that they were secured
from the Internet, I wouldn&#8217;t hesitate to chose the UTM-1.</p>

<p>I&#8217;m really interested to hear what others think. Do you think I made the right
choice? No? Why?  If you care to share your choices, let me know what your
appliance is protecting (users or servers) and what choice you made.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/10/14/new-solaris-10-update-8-zfs-support-flash-archives">New in Solaris 10 Update 8 - ZFS Support in Flash Archives</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-14T00:00:00-05:00" pubdate data-updated="true">Oct 14<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/assets/images/solaris.gif" alt="" />The<a href="http://www.sun.com/aboutsun/pr/2009-10/sunflash.20091008.3.xml"> release of Solaris 10 10/09 (Update
8)</a> has come
and gone, and without too much fanfare from my point of view. In my opinion,
there is one new feature that will really help propel root ZFS installations
into the enterprises where there was resistance before. You see, many larger
corporations have invested a lot of time and money into using Flash Archive
coupled with Jumpstart to be able to deploy golden images to many machines in
a small amount of time. However, up until now, ZFS and Flash Archive were
incompatible, meaning you were forced to use UFS root file systems if you
wanted to use Flash Archive installs. Some have <a href="http://blogs.sun.com/scottdickson/entry/a_much_better_way_to">even went to great lengths to
hack solutions
together</a>, but I
doubt they made many in-roads into the enterprise. Read on for a quick
overview of Flash Archive and ZFS support in the latest update of Solaris 10.</p>

<p>From <a href="http://docs.sun.com/app/docs/doc/819-5461/githk?l=en&amp;a=view">Sun&#8217;s ZFS Administration
Guide</a>, here&#8217;s
some potential &#8220;gotcha&#8217;s&#8221;:</p>

<ul>
<li><p>Only a JumpStart installation of a ZFS Flash archive is supported. You cannot use the interactive installation option of a Flash archive to install a system with a ZFS root file system. Nor can you use a Flash archive to install a ZFS BE with Solaris Live Upgrade.</p></li>
<li><p>You can only install a system of the same architecture with a ZFS Flash archive. For example, an archive that is created on a sun4u system cannot be installed on a sun4v system.</p></li>
<li><p>Only a full initial installation of a ZFS Flash archive is supported. You cannot install differential Flash archive of a ZFS root file system nor can you install a hybrid UFS/ZFS archive.</p></li>
<li><p>Existing UFS Flash archives can still only be used to install a UFS root file system. The ZFS Flash archive can only be used to install a ZFS root file system.</p></li>
<li><p>Although the entire root pool, minus any explicitly excluded datasets, is archived and installed, only the ZFS BE that is booted when the archive is created is usable after the Flash archive is installed. However, pools that are archived with the flar or flarcreate command&#8217;s <strong>-R</strong> rootdir option can be used to archive a root pool other than the one that is currently booted.</p></li>
<li><p>A ZFS root pool name that is created with a Flash archive must match the master root pool name. The root pool name that is used to create the Flash archive is the name that is assigned to the new pool created. Changing the pool name is not supported.</p></li>
<li><p>The flarcreate and flar command options to include and exclude individual files are not supported in a ZFS Flash archive. You can only exclude entire datasets from a ZFS Flash archive.</p></li>
<li><p>The flar info command is not supported for a ZFS Flash archive.</p></li>
</ul>


<p>There&#8217;s a few constraints in there that might cause a few people problems, but
overall Sun has done a good job opening up yet another in-road to the
enterprise folks to let them experience the joy that is administering ZFS.</p>

<p>I have yet to setup Flash Archive and ZFS myself, but once I do, you can bet
I&#8217;ll post about it!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/09/23/not-so-typical-jumpstart-part-three-scripts">Not So Typical Jumpstart: Part Three - the Scripts</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-09-23T00:00:00-05:00" pubdate data-updated="true">Sep 23<span>rd</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img align="left" alt="" height="101" hspace="15" src="/assets/images/solaris.gif" width="190"/>
In <a href="http://www.sysadminsjourney.com/content/2009/09/21/not-so-typical-jumpstart-part-two">part two of the series</a>, we left off with a non-working Custom Jumpstart setup.  By creating our Jumpstart profile file and a sysidcfg file, we&#8217;ll have a basic, but working Custom Jumpstart.  The profile contains settings specific to the installation, where the sysidcfg file contains settings specific to the machine during and after installation.</p>

<h2>Step One: Create the sysidcfg file</h2>

<p>If you&#8217;ve been following along, we specified the path to web1&#8217;s sysidcfg file when we generated our dhcpd.conf file in <a href="http://www.sysadminsjourney.com/content/2009/09/18/not-so-typical-jumpstart-part-one">part one</a>. Let&#8217;s create this file, so that the installer doesn&#8217;t have to ask us these questions during the installation:</p>

<pre>
cd /export/home/jumpstart/configs
mkdir -p sysids/web
cat &lt;&lt;EOD &gt; sysids/web/sysidcfg
keyboard=US-English
system_locale=en_US.UTF-8
security_policy=NONE
nfs4_domain=domain.com
name_service=DNS {domain_name=domain.com name_server=192.168.0.5}
network_interface=bge0 { protocol_ipv6=no
  primary
  hostname=bkeweb1
  ip_address=192.168.0.21
  default_route=192.168.0.10
  netmask=255.255.255.0
}
terminal=vt100
timezone=US/Central
timeserver=localhost
root_password=8X123/ZkOFICY
service_profile=limited_net
EOD
</pre>


<p>You should read the manpage for sysidcfg, but in our example above some of the not-so-obvious settings are:</p>

<ul>
<li><strong>security_policy=NONE</strong> is relative to the kerberos security settings during installation.</li>
<li><strong>root_password</strong> the value of root&#8217;s password as written in a real /etc/shadow file.</li>
<li><strong>service_profile=limited_net</strong> - using limited_net disables unnecessary services and restricts others to localhost access only. I recommend this setting for anyone not in a lab environment.</li>
</ul>


<h2>Step Two: Create the profile file</h2>

<p>There&#8217;s a huge amount of operations you can configure via the jumpstart profile - I recommend reading <a href="http://docs.sun.com/app/docs/doc/820-7014/preparecustom-53442?l=en">Sun&#8217;s documentation on creating a Jumpstart profile</a>. I also owe a link to the <a href="http://kdl.nobugware.com/post/2009/07/28/ultimate-solaris-10-jumpstart-profile/">Keep Da Link</a> blog for a nice list of clusters and packages to install. Using this profile below will result in an installation with pretty much every command line tool you would need, minus any X11/Gnome packages. Here&#8217;s the contents of my Jumpstart profile:</p>

<pre>
cat &lt;&lt;EOD &gt; webserver
install_type    initial_install
system_type     standalone
#pool           name  size swap dump devices
#pool           rpool auto auto auto mirror c0t0d0s0 c0t1d0s0
pool            rpool auto auto auto any
bootenv         installbe bename s10_u7 
partitioning    default

# base cluster
cluster SUNWCreq
# additional clusters and packages
cluster SUNWCacc add # System accounting utilities
cluster SUNWCadm add # System And Network Administration (showrev etc)
cluster SUNWCcpc add # CPU Performance Counter driver and utilities
cluster SUNWCcry add # Supplemental cryptographic modules and libraries
cluster SUNWCfwcmp add # Freeware Compression Utilities (bzip zip zlib gzip)
cluster SUNWCfwshl add # Freeware Shells (bash tcsh zsh)
cluster SUNWCfwutil add # Freeware Other Utilities (gpatch less rpm)
cluster SUNWCgcc add # GNU binutilis, C compiler, m4 and make
cluster SUNWCged add # Gigabit Ethernet Adapter Software
cluster SUNWCjv add # JavaVM
cluster SUNWCjvx add # JavaVM (64-bit)
cluster SUNWClibusb add # wrapper for libusb; user level usb ugen library
cluster SUNWClu add # Live Upgrade Software
cluster SUNWCntp add # Network Time Protocol
cluster SUNWCopenssl add # the classical super-old Solaris OpenSSL
cluster SUNWCpd add # PCI drivers
cluster SUNWCperl add # perl5
cluster SUNWCpm add # Power Management Software
cluster SUNWCpmgr add # Patch Manager Software
cluster SUNWCpool add # core software for resource pools
cluster SUNWCptoo add # Programming tools and libraries
cluster SUNWCrcapu add # Solaris Resource Capping Daemon
cluster SUNWCsma add # Solaris Management Agent (snmpd)
cluster SUNWCssh add # Secure Shell Client/Server
cluster SUNWCts add # Solaris Trusted Extensions
cluster SUNWCusb add # USB drivers and header files
cluster SUNWCutf8 add # en_US.UTF-8 locale support
cluster SUNWCvld add # Sun Ethernet Vlan Utility
cluster SUNWCvol add # Volume Management
cluster SUNWCwget add # GNU wget
cluster SUNWCzone add # Solaris Zones
package SUNWarc add # Lint Libraries (usr)
package SUNWarcr add # Lint Libraries (root)
package SUNWman add # On-Line Manual Pages
package SUNWdoc add # Documentation Tools
package SUNWsfwhea add # Open Source header files
package SUNWtoo add # Programming Tools
package SUNWhea add # SunOS Header Files
package SUNWxcu4 add # XCU4 Utilities
package SUNWxcu4t add # XCU4 make and sccs utilities
package SUNWxcu6 add # XCU6 Utilities
package SUNWgcmn add # gcmn - Common GNU package
package SUNWggrp add # ggrep - GNU grep utilities
package SUNWgtar add # gtar - GNU tar
package SUNWuium add # ICONV Manual pages for UTF-8 Locale
package SUNWladm add # Locale Administrator (really optional)
package SUNWGlib add # GLIB - Library of useful routines for C programming
package SUNWPython-share add # python
package SUNWPython add # python
package SUNWfss add # Fair Share Scheduler
package SUNWscpr add # /usr/ucb tools
package SUNWscpu add # /usr/ucb tools
package SUNWrsg add # needed by sshd
package SUNWgssdh add # needed by sshd
package SUNWspnego add # needed by sshd
package SUNWbind add # host&amp;dig

# optional clusters and packages
#cluster SUNWCapache add # Apache 1.3.9
#cluster SUNWCapch2 add # Apache 2
#cluster SUNWCpostgr add # PostgreSQL
#cluster SUNWCpostgr-82 add # PostgreSQL 8.2
#cluster SUNWCdhcp add # DHCPv4 Services
#cluster SUNWCtcat add # Tomcat Servlet/JSP Container
#package SUNWmysqlr add # MySQL (Root)
#package SUNWmysqlu add # MySQL (User)

# The following are for webstack dependencies
package         SUNWfontconfig
package         SUNWfreetype2
package         SUNWjpg
package         SUNWpng
package         SUNWxwplt
package         SUNWpostgr-82-libs
EOD
</pre>


<p>After running an install with this profile, you will end up with a ZFS root that contains just under 2GB worth of data. If that&#8217;s not your desired setup, then tweak away!</p>

<h2>Step Three: Validate the profile file</h2>

<p>The last step in this article is to validate the rules file and its associated profiles. Run the following:</p>

<pre>
# ./check
Validating rules...
Validating profile webserver...
The custom JumpStart configuration is ok.
</pre>


<p>This process validates your config files, and creates a rules.ok file in the root of your config server directory. It is this file that the client loads and parses when starting a Jumpstart installation.</p>

<p>This concludes part three of the series. You should now be able to boot using PXE for X86 or using &#8216;boot net:dhcp - install&#8217; from Sparc, and have a completely automated installation. However, you likely also have a rather vanilla installation which we&#8217;ll remedy in part four of the series.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/09/22/not-so-typical-jumpstart-part-three-jumpstart-profile">Not So Typical Jumpstart: Part Three - the Jumpstart Profile</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-09-22T00:00:00-05:00" pubdate data-updated="true">Sep 22<span>nd</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/assets/images/solaris.gif" alt="" />In <a href="http://www.sysadminsjourney.com/content/2009/09/21/not-so-typical-jumpstart-part-two">part two of the series</a>, we left off with a non-working Custom Jumpstart setup. By
creating our Jumpstart profile file and a sysidcfg file, we&#8217;ll have a basic,
but working Custom Jumpstart. The profile contains settings specific to the
installation, where the sysidcfg file contains settings specific to the
machine during and after installation.</p>

<h2>Step One: Create the sysidcfg file</h2>

<p>If you&#8217;ve been following along, we specified the path to web1&#8217;s sysidcfg file
when we generated our dhcpd.conf file in <a href="http://www.sysadminsjourney.com/content/2009/09/18/not-so-typical-jumpstart-part-one">part one</a>. Let&#8217;s create this file, so that the installer doesn&#8217;t
have to ask us these questions during the installation:</p>

<div>
  <pre><code class='console'>cd /export/home/jumpstart/configs
mkdir -p sysids/web
cat &lt;&lt;EOD &gt; sysids/web/sysidcfg
keyboard=US-English
system_locale=en_US.UTF-8
security_policy=NONE
nfs4_domain=domain.com
name_service=DNS {domain_name=domain.com name_server=192.168.0.5}
network_interface=bge0 { protocol_ipv6=no
                         primary
                         hostname=bkeweb1
                         ip_address=192.168.0.21
                         default_route=192.168.0.10
                         netmask=255.255.255.0
                        }
terminal=vt100
timezone=US/Central
timeserver=localhost
root_password=8X123/ZkOFICY
service_profile=limited_net
EOD</code></pre>
</div>


<p>You should read the manpage for sysidcfg, but in our example above some of the
not-so-obvious settings are:</p>

<ul>
<li><strong>security_policy=NONE</strong> is relative to the kerberos security settings during installation.</li>
<li><strong>root_password</strong> the value of root&#8217;s password as written in a real /etc/shadow file.</li>
<li><strong>service_profile=limited_net</strong> - using limited_net disables unnecessary services and restricts others to localhost access only. I recommend this setting for anyone not in a lab environment.</li>
</ul>


<h2>Step Two: Create the profile file</h2>

<p>There&#8217;s a huge amount of operations you can configure via the jumpstart
profile - I recommend reading <a href="http://docs.sun.com/app/docs/doc/820-7014/preparecustom-53442?l=en&amp;a=view">Sun&#8217;s documentation on creating a Jumpstart profile</a>. I also owe a link to the <a href="http://kdl.nobugware.com/post/2009/07/28/ultimate-solaris-10-jumpstart-profile/">Keep DaLink</a> blog for a nice list of clusters and packages to install. Using this
profile below will result in an installation with pretty much every command
line tool you would need, minus any X11/Gnome packages. Here&#8217;s the contents of
my Jumpstart profile:</p>

<div>
  <pre><code class='console'>cat &lt;&lt;EOD &gt; webserver
install_type    initial_install
system_type     standalone
#pool           name  size swap dump devices
#pool           rpool auto auto auto mirror c0t0d0s0 c0t1d0s0
pool            rpool auto auto auto any
bootenv         installbe bename s10_u7 
partitioning    default

# base cluster
cluster SUNWCreq
# additional clusters and packages
cluster SUNWCacc add # System accounting utilities
cluster SUNWCadm add # System And Network Administration (showrev etc)
cluster SUNWCcpc add # CPU Performance Counter driver and utilities
cluster SUNWCcry add # Supplemental cryptographic modules and libraries
cluster SUNWCfwcmp add # Freeware Compression Utilities (bzip zip zlib gzip)
cluster SUNWCfwshl add # Freeware Shells (bash tcsh zsh)
cluster SUNWCfwutil add # Freeware Other Utilities (gpatch less rpm)
cluster SUNWCgcc add # GNU binutilis, C compiler, m4 and make
cluster SUNWCged add # Gigabit Ethernet Adapter Software
cluster SUNWCjv add # JavaVM
cluster SUNWCjvx add # JavaVM (64-bit)
cluster SUNWClibusb add # wrapper for libusb; user level usb ugen library
cluster SUNWClu add # Live Upgrade Software
cluster SUNWCntp add # Network Time Protocol
cluster SUNWCopenssl add # the classical super-old Solaris OpenSSL
cluster SUNWCpd add # PCI drivers
cluster SUNWCperl add # perl5
cluster SUNWCpm add # Power Management Software
cluster SUNWCpmgr add # Patch Manager Software
cluster SUNWCpool add # core software for resource pools
cluster SUNWCptoo add # Programming tools and libraries
cluster SUNWCrcapu add # Solaris Resource Capping Daemon
cluster SUNWCsma add # Solaris Management Agent (snmpd)
cluster SUNWCssh add # Secure Shell Client/Server
cluster SUNWCts add # Solaris Trusted Extensions
cluster SUNWCusb add # USB drivers and header files
cluster SUNWCutf8 add # en_US.UTF-8 locale support
cluster SUNWCvld add # Sun Ethernet Vlan Utility
cluster SUNWCvol add # Volume Management
cluster SUNWCwget add # GNU wget
cluster SUNWCzone add # Solaris Zones
package SUNWarc add # Lint Libraries (usr)
package SUNWarcr add # Lint Libraries (root)
package SUNWman add # On-Line Manual Pages
package SUNWdoc add # Documentation Tools
package SUNWsfwhea add # Open Source header files
package SUNWtoo add # Programming Tools
package SUNWhea add # SunOS Header Files
package SUNWxcu4 add # XCU4 Utilities
package SUNWxcu4t add # XCU4 make and sccs utilities
package SUNWxcu6 add # XCU6 Utilities
package SUNWgcmn add # gcmn - Common GNU package
package SUNWggrp add # ggrep - GNU grep utilities
package SUNWgtar add # gtar - GNU tar
package SUNWuium add # ICONV Manual pages for UTF-8 Locale
package SUNWladm add # Locale Administrator (really optional)
package SUNWGlib add # GLIB - Library of useful routines for C programming
package SUNWPython-share add # python
package SUNWPython add # python
package SUNWfss add # Fair Share Scheduler
package SUNWscpr add # /usr/ucb tools
package SUNWscpu add # /usr/ucb tools
package SUNWrsg add # needed by sshd
package SUNWgssdh add # needed by sshd
package SUNWspnego add # needed by sshd
package SUNWbind add # host&amp;dig

# optional clusters and packages
#cluster SUNWCapache add # Apache 1.3.9
#cluster SUNWCapch2 add # Apache 2
#cluster SUNWCpostgr add # PostgreSQL
#cluster SUNWCpostgr-82 add # PostgreSQL 8.2
#cluster SUNWCdhcp add # DHCPv4 Services
#cluster SUNWCtcat add # Tomcat Servlet/JSP Container
#package SUNWmysqlr add # MySQL (Root)
#package SUNWmysqlu add # MySQL (User)

# The following are for webstack dependencies
package         SUNWfontconfig
package         SUNWfreetype2
package         SUNWjpg
package         SUNWpng
package         SUNWxwplt
package         SUNWpostgr-82-libs
EOD</code></pre>
</div>


<p>After running an install with this profile, you will end up with a ZFS root
that contains just under 2GB worth of data. If that&#8217;s not your desired setup,
then tweak away!</p>

<h2>Step Three: Validate the profile file</h2>

<p>The last step in this article is to validate the rules file and its associated
profiles. Run the following:</p>

<div>
  <pre><code class='console'># ./check
Validating rules...
Validating profile webserver...
The custom JumpStart configuration is ok.</code></pre>
</div>


<p>This process validates your config files, and creates a rules.ok file in the
root of your config server directory. It is this file that the client loads
and parses when starting a Jumpstart installation.</p>

<p>This concludes part three of the series. You should now be able to boot using
PXE for X86 or using &#8216;boot net:dhcp - install&#8217; from Sparc, and have a
completely automated installation. However, you likely also have a rather
vanilla installation which we&#8217;ll remedy in part four of the series.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/09/21/not-so-typical-jumpstart-part-two">Not So Typical Jumpstart: Part Two</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-09-21T00:00:00-05:00" pubdate data-updated="true">Sep 21<span>st</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/assets/images/solaris.gif" alt="" />In <a href="/content/2009/09/18%0A/not-so-typical-jumpstart-part-one">part one of the series</a>, we setup the ISC DHCP server. Now it&#8217;s
time to set up our install and config servers &#8211; both of which will reside on
the same box in this case. Solaris Jumpstart uses standard protocols, namely
TFTP and NFS to provide these services. In this post, we&#8217;ll just be setting up
the framework for the real customizations that will come in parts three and
four.</p>

<h2>Step 1: Setup the Install Server</h2>

<p>In our example, we&#8217;ll be assuming that our install and config directories will
be setup under /export/home/jumpstart/. So, pop the Solaris 10 DVD into the
drive of your server, and issue the following commands as root:</p>

<pre><code>mkdir -p /export/home/jumpstart/install/s10u7s
cd /cdrom/cdrom0/Solaris_10/Tools
./setup_install_server /export/home/jumpstart/install/s10u7s
</code></pre>

<p>Once that&#8217;s done (it will take awhile), we need to make sure the NFS server is
running, and share our install location as a read-only mountpoint:</p>

<pre><code>svcadm enable nfs/server
echo 'share -F nfs -o ro,anon=0 -d "install server directory" /export/home/jumpstart/install/s10u7s' &gt;&gt; /etc/dfs/dfstab
shareall
</code></pre>

<p>Now, it&#8217;s time to create a boot file and make it available via TFTP download
for our client:</p>

<pre><code>cd /export/home/jumpstart/install/s10u7s/Solaris_10/Tools
./add_install_client -d SUNW,Sun-Fire-T1000 sun4v
svcadm enable tftp/udp6
</code></pre>

<p><strong>Note that the add_install_client command is likely not a command you can cut and paste!</strong> To determine the two arguments to add_install_client, you need to run some uname&#8217;s if you&#8217;re deploying to Sparc. To get the platform name, run &#8216;uname -i&#8217;, and replace the &#8216;SUNW,Sun-Fire-T1000&#8217; string above with the response. Then, run &#8216;uname -m&#8217;, and replace sun4v with the response (which will most likely be sun4u). If you&#8217;re running x86, you&#8217;ll run this command:</p>

<pre><code>./add_install_client -d SUNW.i86pc i86pc
</code></pre>

<p>At this point, you can do <strong>interactive</strong> network installations of the Solaris
OS to your client. In fact, I recommend that you go ahead and try booting from
the network and make sure that everything&#8217;s setup to this point. On a Sparc
box, from OBP, type &#8216;boot net:dhcp - install&#8217;. If you&#8217;re on x86, boot via PXE.
If you don&#8217;t have a working network installation at this point, stop here and
get it working before you move on to setting up the config server.</p>

<h2>Step 2: Setup the Config Server</h2>

<p>We could do an interactive network install, which is helpful for systems that
may not have a CD/DVD drive, but really &#8211; where&#8217;s the fun in that? We&#8217;re
striving for automation here! That&#8217;s where the config server comes in. The
config server provides a sysidcfg file to the system which tells it things
like what IP&#8217;s belong on what interfaces, what is my hostname, etc. The
sysidcfg file tells the system settings that will be unique to that system.
The other function of the config server is to provide the jumpstart profile
and all the scripts that the profile refers to. The jumpstart profile tells
the machine specifics about the installation procedure &#8211; what packages to
install, what locale to use, etc. Let&#8217;s setup our directories first:</p>

<pre><code>for d in scripts sshkeys sysids jumpstart_sample; do
mkdir -p /export/home/jumpstart/configs/$d
done
echo 'share -F nfs -o ro,anon=0 /export/home/jumpstart/configs' &gt;&gt; /etc/dfs/dfstab
shareall
</code></pre>

<p>We&#8217;ve created our configs directory, which is the root of the config server
setup. We created a few subdirectories &#8211; scripts is where we&#8217;ll store our
add-on scripts, sshkeys is where we&#8217;ll keep our ssh public keys, sysids is
where the system-specific sysidcfg files will be stored, and jumpstart_sample
is where we will keep our jumpstart_sample profiles. These files are handy to
have around for reference. Let&#8217;s copy those over now:</p>

<pre><code>cp /export/home/jumpstart/install/s10u7s/Solaris_10/Misc/jumpstart_sample/* /export/home/jumpstart/configs/jumpstart_sample
</code></pre>

<p>Now, we&#8217;re ready to create our jumpstart rules file. Run the following:</p>

<pre><code>cd /export/home/jumpstart/configs/
ln -s  /export/home/jumpstart/configs/check  /export/home/jumpstart/configs/jumpstart_sample/check
echo "hostname web1    delete_raidctl_vols    webserver      webserver_finish.sh" &gt;&gt; rules
touch delete_raidctl_vols webserver_finish.sh
chmod 755 delete_raidctl_vols webserver_finish.sh
</code></pre>

<p>We added one rule to the rules file. There is a well-commented rules file in
the jumpstart_sample directory that you can pour over to get all the gory
details. In our rules file, we&#8217;re essentially saying this:</p>

<ul>
<li><strong>hostname web1</strong>: Any client that has a hostname equal to &#8216;web1&#8217; will use this rule. Remember in part one when I told you to jot down the hostname we used in dhcpd.conf? That hostname and this one have to match exactly.</li>
<li><strong>delete_raidctl_vols</strong>: This is the begin script. It is ran before the actual installation occurs. If you don&#8217;t need a begin script, you can simply use a &#8216;-&#8217; here. Right now, delete_raidctl_vols is empty, but in part four we&#8217;ll populate it with a script that deletes any &#8220;hardware&#8221; raid volumes so that we can use ZFS software mirroring in our installation.</li>
<li><strong>webserver</strong>: This is the actual jumpstart profile file. We&#8217;ll go over this in part three.</li>
<li><strong>webserver_finish</strong>: This is the finish script. This script provides the sysadmin with an interface to do anything he wants via a shell script after installation, but before reboot. All the power of jumpstart is in this one file. We&#8217;ll cover that in part four. Just as with the begin script, if you don&#8217;t need a finish script, just use a dash here.</li>
</ul>


<p>At this point, we still don&#8217;t have a full custom jumpstart setup yet. Before
it&#8217;s ready to be tested, we need to add the content to our &#8216;webserver&#8217;
jumpstart profile file, and run the &#8216;check&#8217; command on it to generate the
rules.ok file. We&#8217;ll do this in part three. Part four will cover some examples
of things you can do in the begin and finish scripts - stay tuned!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/09/18/not-so-typical-jumpstart-part-one">Not So Typical Jumpstart: Part One</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-09-18T00:00:00-05:00" pubdate data-updated="true">Sep 18<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/assets/images/solaris.gif" alt="" />Only in my world do you get a RHCE one week,
and then come back and work on nothing but Solaris Jumpstart for the next
couple of weeks! Oh well, it&#8217;s always good as long as you&#8217;re learning. What
started out as a simple upgrade from Apache 2.0 to 2.2 quickly turned into re-
provisioning our web tier. We could have upgraded, but there ended up being so
many dependencies needed I decided that it would be easier to just start fresh
with Solaris 10u7 on all our webservers. Since I knew that I&#8217;d be doing this
to all our webservers, it made sense to spend the time up-front on setup up a
completely automated installation. This time spent on the front-end should
save a huge amount of time on the back side when it comes to troubleshooting.
In my case, I learned a lot of undocumented tips and tricks, and stumbled
across a few &#8220;gotchas&#8221; as well. After going through an exercise like this, I
now know what Puppet is for, and ordered my first book. I&#8217;ll give a review
once I&#8217;m done.</p>

<p>First of all, we already have an ISC DHCPd server running to provide Red Hat
Kickstart installs, so I decided to leverage that. Sun&#8217;s DHCPd works fine, but
it&#8217;s a completely different beast when it comes to configuration.</p>

<p>Part one of the series covers setting up your dhcpd.conf.</p>

<h2>Set Up Your ISC DHCP Server</h2>

<p>There&#8217;s not too much involved here, but there is a gotcha or two involved. I
used <a href="http://www.sun.com/bigadmin/content/submitted/setup_dhcp.jsp">this article on BigAdmin</a> as the
primary source for this info.</p>

<p>When all was said and done, I had added this to my already existing
dhcpd.conf:</p>

<div>
  <pre><code class='console'># Jumpstart Support
option space SUNW;
option SUNW.root-mount-options code 1 = text;
option SUNW.root-server-ip-address code 2 = ip-address;
option SUNW.root-server-hostname code 3 = text;
option SUNW.root-path-name code 4 = text;
option SUNW.swap-server-ip-address code 5 = ip-address;
option SUNW.swap-file-path code 6 = text;
option SUNW.boot-file-path code 7 = text;
option SUNW.posix-timezone-string code 8 = text;
option SUNW.boot-read-size code 9 = unsigned integer 16;
option SUNW.install-server-ip-address code 10 = ip-address;
option SUNW.install-server-hostname code 11 = text;
option SUNW.install-path code 12 = text;
option SUNW.sysid-config-file-server code 13 = text;
option SUNW.JumpStart-server code 14 = text;
option SUNW.terminal-name code 15 = text;
option SUNW.SbootURI code 16 = text;
# Solaris 10 SPARC 05/09
group {
   use-host-decl-names on;
   next-server 192.168.0.28;
   vendor-option-space SUNW;
   option SUNW.JumpStart-server &quot;192.168.0.28:/export/home/jumpstart/configs&quot;;
   option SUNW.install-server-hostname &quot;192.168.0.28&quot;;
   option SUNW.install-server-ip-address 192.168.0.28;
   option SUNW.install-path &quot;/export/home/jumpstart/install/s10u7s&quot;;
   option SUNW.root-server-hostname &quot;192.168.0.28&quot;;
   option SUNW.root-server-ip-address 192.168.0.28;
   option SUNW.root-path-name &quot;/export/home/jumpstart/install/s10u7s/Solaris_10/Tools/Boot&quot;;

  host web1 { 
        hardware ethernet 00:14:4f:cb:66:79;
        option SUNW.sysid-config-file-server = &quot;192.168.0.28:/export/home/jumpstart/configs/sysids/web&quot;; 
        }

}</code></pre>
</div>


<p>Things of note:</p>

<ul>
<li>192.168.0.28 is the IP of our yet-to-be-setup NFS/TFTP server</li>
<li>Make note of the hostname you use in the host stanza above (web1 in our case) &#8211; we&#8217;ll need it later.</li>
</ul>


<h3><strong>GOTCHA #1:</strong></h3>

<p>In the <a href="http://www.sun.com/bigadmin/content/submitted/setup_dhcp.jsp">previously mentioned BigAdmin article</a>, you
may get the impression that the SUNW.sysid-config-file-server option is the
path to a file. <strong>It isn&#8217;t, it&#8217;s the path to a directory that contains a file
named sysidcfg.</strong> It took a packet sniffer to tell me that one.</p>

<h3><strong>GOTCHA #2:</strong></h3>

<p>Note how I used IP addresses instead of hostnames in many of the options
above? I also use some abbreviations like s10u7s for &#8220;Solaris 10 Update 7
Sparc&#8221;. This is due to an incompatibility between the ISC DHCP server and the
Solaris DHCP client. If the vendor specific options exceed 255 bytes, then ISC
DHCP will send another packet containing the remainder of the options.
<a href="http://osdir.com/ml/network.dhcp.isc.dhcp-server/2003-03/msg00176.html">Solaris&#8217; DHCP client doesn&#8217;t know how to deal with this</a>.
If you swear you have everything right, but Jumpstart isn&#8217;t taking off, you
might be getting bit by this. tcpdump/snoop will tell you for sure.</p>

<p>At this point, you should be able to test your DHCP config, and restart your
ISC DHCP server. Next, we&#8217;ll setup our Solaris TFTP/NFS server with the
necessary media to allow our Jumstart installation to happen.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/09/16/random-password-generation-perl-one-liner">Random Password Generation in a Perl One-Liner</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-09-16T00:00:00-05:00" pubdate data-updated="true">Sep 16<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Say you need a quick random 8 character alpha-numeric password. In sh, there
isn&#8217;t a $RANDOM variable and tr can give different results on different OS&#8217;s.
More than likely you have perl available - use it! <div>
  <pre><code class='bash'>perl
-le 'print map { (a..z,A..Z,0..9)[rand 62] } 0..pop' 8</code></pre>
</div></p>

<p>Thanks to <a href="http://www.chrisangell.com/oneliners.html">Chris Angell&#8217;s Perl One-
Liner</a> page for this one. Do you
have a better cross-platform way of doing it? Let me know!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/09/01/apache-2212-2213-and-solaris-10-bug-nastiness">Apache 2.2.12 - 2.2.13 and Solaris 10 Bug Nastiness</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-09-01T00:00:00-05:00" pubdate data-updated="true">Sep 1<span>st</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/assets/images/feather.gif" alt="" />At work, I&#8217;ve been working on an upgrade from a
custom-compiled version of Apache 2.0.x to the Sun-provided <a href="http://www.sun.com/software/webstack/index.xml">Glassfish
Webstack</a> 1.5. I spent about a
week troubleshooting what I thought was configuration issue, only to finally
find it&#8217;s a bug way upstream in Apache 2.2.12+. This bug only affects Solaris
10, and is near-impossible to reproduce. If you use Solaris 10 and Apache,
read on so you don&#8217;t waste a week of your life like I did.</p>

<p>The problem presented itself as Apache intermittently hanging. It didn&#8217;t
depend on load, or anything else. Sometimes it would happen at 2pm in the
afternoon, other times at 4am. While load isn&#8217;t required, a lot of
simultaneous connnections helps trigger the bug. The guy I worked with at Sun
had to introduce some sleep times into the Apache source code in order to
trigger it, so my guess is that it&#8217;s a race condition on the microsecond
level.</p>

<p>Basically, Nagios would alert me that Apache had quit responding. netstat
showed a huge number of connections stuck in a CLOSE_WAIT state. Either
restarting or gracefully restarting Apache would resolve the issue. Luckily, I
found the solution before I had to pull out pstack and truss.</p>

<p>If you think you might be encountering the same bug, the first prerequisite is
that you have multiple <strong>Listen</strong> statements in your config (most everyone
does). If you do, then do the following to your stuck Apache.</p>

<ol>
<li><h1>pstack <code>pgrep httpd</code> > /tmp/httpd_pstack.txt</h1></li>
<li><p>Find the pid in apr_pollset_poll(). Looking through httpd_pstack.txt, exactly one process should have this backtrace:</p></li>
</ol>


<pre><code>1652: /usr/apache2/2.2/bin/httpd -k start
    feda1167 portfs (6, 13, 835d350, 2, 1, 8047b48)
    feedd302 apr_pollset_poll (835d308, 989680, 0, 8047ba4, 8047ba8, 2) + 126
    08091611 child_main (0, 8090fac, 8047c08, 8091801) + 329
    08091846 make_child (80c8128, 0, 0, 80c4228) + 86
    0809192f startup_children (5, 80c6230, 8047d18, 8091a47) + 43
    08091ab6 ap_mpm_run (80c6230, 80f42e8, 80c8128, 8070831) + 162
    0807083e main (3, 8047ddc, 8047dec, feffb7b4) + 812
    0806f9fd _start (3, 8047e8c, 8047ea7, 8047eaa, 0, 8047eb0) + 7d
</code></pre>

<p>In this case, the pid is 1652.</p>

<p>If you don&#8217;t find such a pid, you have a different problem.</p>

<ol>
<li>Run truss against the pid in apr_pollset_poll()</li>
</ol>


<pre><code># truss -p 1652 
</code></pre>

<p>It should look like this:</p>

<pre><code>    port_getn(19, 0x0835D350, 2, 1, 0x08047B48) (sleeping...)
    port_getn(19, 0x0835D350, 2, 1, 0x08047B48) = 0 [62]
    port_getn(19, 0x0835D350, 2, 1, 0x08047B48) (sleeping...)
</code></pre>

<p>&#8230; (over and over)</p>

<p>with port_getn() returning about every 10 seconds, and the web side</p>

<p>inaccessible during this time.</p>

<p>If this is what you have, then you are indeed being bitten by this bug.
Initially, I found <a href="http://forums.sun.com/thread.jspa?threadID=5402863">a post on the Webstack forums that put me in touch with
Jeff Trawick</a>. After doing
a bit more digging, I found <a href="https://issues.apache.org/bugzilla/show_bug.cgi?id=47645">the Apache HTTPD bug
report</a>. After
emailing Jeff, he was able to send me a .so file that I could load before
executing Apache that fixes the problem. I don&#8217;t have the okay to
redistribute, so email Jeff if you need the fix. Sun more than likely won&#8217;t
release an official update to Glassfish Webstack to resolve the issue, and
going forward Apache 2.2.14 will include Jeff&#8217;s fix (technically the bug is in
APR and is fixed in APR 1.3.9 which will be included in httpd 2.2.14).</p>

<p>Many thanks to Jeff Trawick for his quick help, as well as the steps on how to
confirm existence of the bug using the steps listed above.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/08/26/scsa-vs-rhce">SCSA vs RHCE</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-08-26T00:00:00-05:00" pubdate data-updated="true">Aug 26<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>After taking and passing both my SCSA and my RHCE exams this year, it&#8217;s time
to reflect.  Read on for the pros and cons of each from a student&#8217;s point of
view.</p>

<h2>SCSA</h2>

<p>The Sun Certified Solaris Administrator certification is obtained by taking
two exams.  Both exams are all multiple choice and drag-and-drop format.  The
first test costs $300 and consists of 59 questions; you have 2 hours in which
to complete them.  Anything over 61% is passing, and you walk out of the
testing center with your grade in-hand.  You must pass this first test before
moving to the second test.</p>

<p>The second test also costs $300, and consists of 60 questions.  Anything over
63% is passing, and you have 105 minutes to complete the second test.  Like
the first test, all the questions are multiple choice or drag-and-drop, and
you walk out with your grade in-hand.</p>

<p>The time limits on both exams were adequate for me.  I had enough time to go
through once, then review all my answers at leisure with a little time
remaining.</p>

<p>Find out more from <a href="http://www.sun.com/training/certification/solaris/scsa.xml">Sun&#8217;s SCSA home
page</a>.</p>

<h2>RHCE</h2>

<p>The Red Hat Certified Engineer certification is obtained by taking one exam.
The exam costs $799, and you have 3.5 hours to finish the exam.  The exam
includes content from the RHCT and the RHCE &#8211; you must score 70% or higher on
the RHCT portion, and 70% or higher on the RHCE content to get your RHCE.  It
is possible to get over 70% on the RHCT portion, but get less than 70% on the
RHCE content; in this case you will obtain your RHCT (think of it as a
consolation prize). You will not know your score until some time after your
exam. I took my exam on Friday and got my score Tuesday afternoon.</p>

<p>The exam is what Red Hat calls a &#8220;performance-based&#8221; test environment.  There
are no multiple choice, drag-and-drop, or written answers.  You sit down at a
machine, and your questions tell you do things to that machine.  Red Hat
doesn&#8217;t care how you get the machine there, they only care about the end state
of the machine.</p>

<p>The time limit on the exam was enough for me to go once through, and then go
back and double check my answers one time with only a couple minutes to spare.
I actually found some mistakes on my review, so it was time well spent.  The
nature of the performance-based exam means that you may not be able to proceed
to the next step until you finish the current step, so if you get stuck, you
may find yourself short on time.</p>

<p>Start your research at <a href="http://www.redhat.com/certification/rhce/">Red Hat&#8217;s RHCE home
page</a>.</p>

<h2>My Opinion</h2>

<p>I&#8217;m under NDA&#8217;s for both exams, so I&#8217;m limited in what I can say.  Here&#8217;s a
few points to ponder:</p>

<ul>
<li><strong>RHCE</strong>

<ul>
<li>I feel like a huge nerd for saying this, but the RHCE was the most fun I&#8217;ve ever had during a test.</li>
<li>You don&#8217;t get access to the Internet, but you do have access to the commands and the man pages just like you would in the real world.</li>
<li>The RHCE does not test your memorization skills, your ability to &#8220;read between the lines&#8221;, or your test-taking ability.  It tests your ability to administer a Red Hat Linux system.</li>
</ul>
</li>
<li><strong>SCSA</strong>

<ul>
<li>The SCSA covers, in my opinion, much more information &#8211; both in depth and in width.</li>
<li>There are what I would call trick questions, and you are tested on your ability to memorize.  You have to memorize command-line flags, and many times you have to really read into the question to determine the right answer.  I honestly left the testing center angry, because much of what I missed I felt that I knew the answer to.</li>
</ul>
</li>
</ul>


<p>This could be due to my background knowledge on the two exams, but it felt to
me like the SCSA exam focuses more on the core OS, whereas you have more focus
on some third party daemons on the RHCE.  For example, setting up an IMAP
server is on the RHCE Exam Prep page, but not addressed by the SCSA
Objectives.</p>

<p>Both exams have free online assessments you can do to find out where you
stand, both have the objectives of the exam listed online, and all the study
material you need is available free online.</p>

<h2>Study Materials Used</h2>

<p>Personally, for the RCHE, I took the RH300 &#8220;Rapid Track&#8221; course, which served
as a nice refresher course before taking the exam.  I think I would have
obtained my RHCE without the course, but I certainly wouldn&#8217;t have done so
well.  Aside from the course, I didn&#8217;t buy any books or anything.  Oh, but I
have used Red Hat since Red Hat Linux 5.2 - that&#8217;s gotta count for something.</p>

<p>For the SCSA, I bought Sun&#8217;s Web-Based training course.  After taking the
first exam, I felt the course was inadequate in preparing me for the exam, so
I picked up Bill Calkins <a href="http://www.unixed.c%0Aom/certification/Solaris_10_Exam_Prep_CX-310-20/solaris_10_exam_prep_cx-310-20%0A1.htm">Solaris 10 Exam Prep CX-310-202</a> book.  It was excellent, and I strongly recommend it to anyone looking
to take the exam.  The book actually hadn&#8217;t been printed yet when I needed it,
and I picked it up pre-press via Safari&#8217;s RoughCuts program.  I actually had
quite a few emails back and forth with the author &#8211; he knows his stuff and
does an excellent job teaching the reader.</p>

<h2>In Closing</h2>

<p>In the end, I must say that I feel that I learned more by obtaining my SCSA,
but much of that knowledge was has &#8220;fell away&#8221;.  I remember the technologies,
but I&#8217;ve forgotten the command-line flags I was forced to memorize.  The RHCE,
on the other hand, was almost easy for me.  It tests not what you&#8217;ve
memorized, but what you <strong>know</strong>.</p>

<p>I&#8217;m glad I have both, but I think all certifications should take Red Hat&#8217;s
lead and switch to that testing format.  I feel it&#8217;s far and away a better
real-world testing method.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/5/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/3/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/content/using-git-submodules-dynamic-puppet-environments">Using Git Submodules with Dynamic Puppet Environments</a>
      </li>
    
      <li class="post">
        <a href="/content/2011/11/14/vpsnet-review">VPS.net review</a>
      </li>
    
      <li class="post">
        <a href="/content/2011/10/19/its-not-you-its-me-call-node-gallery-co-maintainers">It&#8217;s not you, it&#8217;s me: Call for Node Gallery co-maintainers</a>
      </li>
    
      <li class="post">
        <a href="/content/2011/09/20/drupal-heroku">Drupal on Heroku</a>
      </li>
    
      <li class="post">
        <a href="/content/2011/04/19/selecting-right-cdn-your-website">Selecting the right CDN for YOUR website</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/justintime">@justintime</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'justintime',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("justinellison", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/justinellison" class="twitter-follow-button" data-show-count="false">Follow @justinellison</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Justin Ellison -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sysadminsjourney';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
