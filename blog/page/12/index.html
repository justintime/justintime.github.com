
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>SysAdmin's Journey</title>
  <meta name="author" content="Justin Ellison">

  
  <meta name="description" content="Follow the jump to read more about ELOG, the
best little logbook available! When I read the LifeHacker article about how
to simplify troubleshooting &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://justintime.github.com/blog/page/12/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="SysAdmin's Journey" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-5430710-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">SysAdmin's Journey</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:justintime.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/contact">Contact</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2008/08/07/power-and-simplicity-elog">The Power and Simplicity of ELOG</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-08-07T00:00:00-05:00" pubdate data-updated="true">Aug 7<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Follow the jump to read more about <a href="https://midas.psi.ch/elog/">ELOG</a>, the
best little logbook available!  When I read <a href="http://lifehacker.com/399919%0A/simplify-troubleshooting-with-a-change-log">the LifeHacker article about how
to simplify troubleshooting with a ChangeLog</a>, I immediately thought about one
of my favorite webapps - <a href="https://midas.psi.ch/elog/">ELOG</a>. Written by Stefan
Ritt, ELOG aims to be simple, self-contained, performant, and extendable. It
achieves all of these goals and surpasses them. ELOG is written in C, and is
it&#8217;s own webserver. No need to run Apache, it&#8217;s got it&#8217;s own. It&#8217;s single
threaded, but for what it is, one thread is enough. We use it to keep track of
our servers at work, we have a ServerLog logbook. We also use it as a Change
Request management tool. It has done both for us without a hiccup, let alone a
crash in the two years we&#8217;ve used it. A feature request I made to Stefan was
implemented that same week! Anyways, if you&#8217;re looking for an application to
log entries of data over time, look no further than
<a href="https://midas.psi.ch/elog/">ELOG</a>!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2008/08/04/quick-easy-apache-ssl-centos">Quick and Easy Apache SSL on CentOS</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-08-04T00:00:00-05:00" pubdate data-updated="true">Aug 4<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Follow the jump to find out how you can quickly and easily setup
your own SSL certificate and install it into Apache on CentOS/RHEL.
First, we need to install the crypto-utils package, which gives us
the super-handy genkey command.  We&#8217;ll also pull in mod_ssl at the
same time:</p>

<pre><code>yum install crypto-utils mod_ssl
</code></pre>

<p>With that out of the way, let&#8217;s run genkey for our sample domain,
www.mydomain.com:</p>

<pre><code>genkey --days=3650 www.mydomain.com
</code></pre>

<ol>
<li>Click Next</li>
<li>Highlight &#8220;1024&#8221;, click Next</li>
<li>Click No</li>
<li>Fill in the form fields, making sure that the Common Name is
the name you&#8217;ll be typing in your browser&#8217;s URL bar.  Click Next</li>
<li>Don&#8217;t select &#8220;Encrypt the private key&#8221; unless you want to type
in the passphrase every time you start Apache.  Click Next.</li>
</ol>


<p>Now, we have our keys generated, we just need to tell Apache to use
them.  <strong>Please note:</strong>The SSLCertificateFile changes the file
extension from <strong>crt</strong>to <strong>cert</strong>!</p>

<pre><code>SSLCertificateFile /etc/pki/tls/certs/www.mydomain.com.cert
SSLCertificateKeyFile /etc/pki/tls/private/www.mydomain.com.key
</code></pre>

<p>Restart Apache, and test it out!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2008/08/02/simple-effective-apachemysql-backups-your-blogcms">Simple and Effective Apache+MySQL Backups for Your Blog/CMS</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-08-02T00:00:00-05:00" pubdate data-updated="true">Aug 2<span>nd</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As part of setting up my new <a title="Linode" href="http://www.linode.com/?r=c4f79463ba583ec1f15e3307190bda4bda9d65df">Linode</a> host, I needed a quick, easy, and maintanable way to create backups of my LAMP webapps.  Follow the jump to see how I set up my backup strategy.</p>

<!--break-->


<p><strong>DISCLAIMER:</strong> I make no guarantees to the effectiveness of this script.  It works for me, and it should work for you, but it is up to you to test it!  Also note, you need to have SSH access and root privileges to your server.</p>

<p>I needed a quick way to get a backup strategy in place that would create a daily snapshot of my <a href="http://www.wordpress.org">Wordpress</a> and <a href="http://www.drupal.org">Drupal</a> code and MySQL databases.  Basically, I keep a 7 day rotation of each webapp&#8217;s code and MySQL, so that if I do something to break my app, I can at least restore it back to the previous day&#8217;s state.  Also, before I install a new plugin or hack on a theme, I can create a snapshot by firing off one script.</p>

<p>I had an advantage since I was starting things from scratch - I could name things consistently.  One of the assumptions that is made is that the directory name of the Apache DocumentRoot of your webapp is the same as the name of your MySQL database.  Obviously, you can&#8217;t go changing your MySQL db names around very easily, but you can use symbolic links to make your document root&#8217;s have the same name as your DB.</p>

<p>First, let&#8217;s setup our hypothetical webapp, which will be a wordpress blog.  We&#8217;ll call it MySite_wp.  For the purpose of this example, we have a directory /apps/MySite_wp which is the document root for the Wordpress installation.  There is a directory named /apps/snapshots/ where we will store our daily snapshots of our document root, and a directory named /apps/mysqlbackups/ where we will store our MySQL database backups.  Finally, our custom scripts will be stored in /apps/scripts.</p>

<h3>Step One: Backup MySQL</h3>


<p>First, let&#8217;s setup our script that does our MySQL backup.  This is a shell script that I wrote because the scripts offered by <a href="http://www.zmanda.org">Zmanda</a> were a little overkill for what I wanted.  I therefore came up with my own shell script that will backup any db you specify on the command line.  Let&#8217;s create this script, and name it /apps/scripts/backupMySQL.sh:</p>

<pre>#!/bin/bash

#set -x

USER=root
PASS=mysqlrootpassword
DEST=/apps/mysqlbackups/archives
MYSQLBIN=/usr/bin
LOGROTATE=/usr/sbin/logrotate

cmp_versions() {
   [ "$1" == "$2" ] &amp;&amp; return 10

   ver1front=`echo $1 | cut -d "." -f -1`
   ver1back=`echo $1 | cut -d "." -f 2-`
   ver2front=`echo $2 | cut -d "." -f -1`
   ver2back=`echo $2 | cut -d "." -f 2-`

   if [ "$ver1front" != "$1" ] || [ "$ver2front" != "$2" ]; then
      [ "$ver1front" -gt "$ver2front" ] &amp;&amp; return 11
      [ "$ver1front" -lt "$ver2front" ] &amp;&amp; return 9

      [ "$ver1front" == "$1" ] || [ -z "$ver1back" ] &amp;&amp; ver1back=0
      [ "$ver2front" == "$2" ] || [ -z "$ver2back" ] &amp;&amp; ver2back=0
      cmp_versions "$ver1back" "$ver2back"
      return $?
   else
      [ "$1" -gt "$2" ] &amp;&amp; return 11 || return 9
   fi
}

get_dump_opts() {
  cmp_versions "$VERSION" "4.1.0"
  RV=$?
  if [ $RV -eq 9 ]; then
    MYDUMP="$MYDUMP --skip-lock-tables --all"
  else
    cmp_versions "$VERSION" "4.1.2"
    RV=$?
    if [ $RV -eq 11 ]; then
      MYDUMP="$MYDUMP --default-character-set=utf8 --create-options"
    else
      MYDUMP="$MYDUMP --default-character-set=utf8 --all"
    fi
  fi
}

SCRIPTDIR=`dirname $0`
if [[ "$SCRIPTDIR" == "." || -z "$SCRIPTDIR" ]]; then
  SCRIPTDIR=$PWD
fi
LOGROTATECFG="$SCRIPTDIR/mysqlbackup.logrotate"
MYDUMP="$MYSQLBIN/mysqldump --user=$USER --password=$PASS --opt --extended-insert \
 --single-transaction"
MYSQL=$MYSQLBIN/mysql

VERSION=`$MYSQLBIN/mysqladmin --user $USER --password=$PASS version | \
 grep "Server version" | awk '{ print $3; }'`

if [ -z "$1" ]; then
  echo "I need a database to back up!!!"
  exit 1
fi

get_dump_opts

while [ ! -z "$1" ]; do
   DB=$1
   touch $DEST/$DB.sql
   chmod 400 $DEST/$DB.sql
   #Version specific dump
   $MYDUMP $DB &gt; $DEST/$DB.sql
   if [ $? -ne 0 ]; then
     echo "MySQL Dump of $DB had an error!"
     exit 1
   fi
   shift
done

$MYSQL --user=$USER --password=$PASS \
-e "PURGE MASTER LOGS BEFORE DATE_SUB( NOW( ), INTERVAL 31 DAY);"

if [ $? -ne 0 ]; then
  echo "MySQL log purge had an error!"
  exit 1
fi

if [ ! -e $LOGROTATECFG ]; then
  cat &gt; $LOGROTATECFG &lt;&lt;EOF
# Rotate MySQL backups
$DEST/*.sql {
   notifempty
   daily
   rotate 7
   compress
}
EOF
fi

if [ ! -x $LOGROTATE ]; then
  echo "Logrotate not executable, skipping rotation"
  exit 1
else
  $LOGROTATE -f $LOGROTATECFG
  if [ $? -ne 0 ]; then
    echo "Logrotate had an error!"
    exit 1
  fi
fi
</pre>


<p>Now, make sure you edit the variables at the top of this script to your installation.  Since this script contains the root password to your MySQL install, run</p>

<pre>
chmod 700 /apps/scripts/backupMySQL.sh
</pre>


<p>to make it so only the root user can view the password.</p>

<p>Now, let&#8217;s test the script.  Jump out to a command prompt, and run &#8216;/apps/scripts/backupMySQL.sh MySite_wp&#8217;.  Once that&#8217;s done, look in the /apps/mysqlbackups/archives directory, and you should see a gzipped sql file sitting there.  Step one, done!</p>

<h3>Step Two: Backup the Document Root</h3>


<p>Now, we need to setup the script that will backup our actual files (usually php files).  Now, most of us have very little data that actually changes from day to day in our PHP files.  Most of the dynamic data is stored in the database.  So, to prevent wasting a bunch of space backing up the exact same file multiple times, we will leverage the hard linking feature of rsync.  Please note that this script is not my own, the majority of the code comes from <a href="http://www.mikerubel.org/computers/rsync_snapshots/">Mike Rubel&#8217;s site</a>.  Now, create the file /apps/scripts/rsyncBackup.sh, and put this code in it:</p>

<pre>
#!/bin/bash

unset PATH

KEEP=7

# ------------- system commands used by this script --------------------
ID=/usr/bin/id
ECHO=/bin/echo

RM=/bin/rm
MV=/bin/mv
CP=/bin/cp
TOUCH=/bin/touch
MKDIR=/bin/mkdir
RSYNC=/usr/bin/rsync
SEQ=/usr/bin/seq


# ------------- file locations -----------------------------------------

SOURCE_DIR=$1
SNAPSHOT_DIR=$2

# ------------- the script itself --------------------------------------

# make sure we're running as root
if (( `$ID -u` != 0 )); then { $ECHO "Sorry, must be root.  Exiting..."; exit; } fi

#Check our args
if [ -z "$SOURCE_DIR" ]; then
  $ECHO "Please pass a source directory as argument 1!";
  exit 1;
fi

if [ -z "$SNAPSHOT_DIR" ]; then
  $ECHO "Please pass a source directory as argument 1!";
  exit 1;
fi

#Check our DIR's
if [ ! -d $SOURCE_DIR ]; then
  $ECHO "$SOURCE_DIR is not a directory!";
  exit 1;
fi

if [ ! -d $SNAPSHOT_DIR/ ]; then
  $MKDIR -p $SNAPSHOT_DIR
fi

if (( $? )); then
{
    $ECHO "snapshot: could not create directory $SNAPSHOT_DIR";
    exit;
}
fi;

#Rotation:
#Account for backup.0
let KEEP=$KEEP-1

for i in `$SEQ $KEEP -1 0`; do
  # Delete the last rotation
  if [ $i == $KEEP ]; then
    $RM -rf $SNAPSHOT_DIR/daily.$i
  else
    # shift the middle snapshots(s) back by one, if they exist
    let NEXT=$i+1
    if [ -d $SNAPSHOT_DIR/daily.$i ] ; then         \
      $MV $SNAPSHOT_DIR/daily.$i $SNAPSHOT_DIR/daily.$NEXT
    fi;
  fi
done

#rsync
CMD="$RSYNC -a --delete --delete-excluded "
CMD="$CMD --link-dest=$SNAPSHOT_DIR/daily.1 "
CMD="$CMD $SOURCE_DIR/* $SNAPSHOT_DIR/daily.0"

if [ ! -d $SNAPSHOT_DIR/daily.0 ]; then
  $MKDIR -p $SNAPSHOT_DIR/daily.0
fi

eval $CMD
</pre>


<p>Now, do a &#8216;chmod 755 /apps/scripts/rsyncBackup.sh&#8217; and let&#8217;s test it out.  Run &#8216;/apps/scripts/rsyncBackup.sh MySite_wp&#8217;.  Once completed, have a look in /apps/snapshots/MySite_wp/.  You will have a directory named daily.0 that will contain a snapshot of your application.  If you run the same command again, the current daily.0 contents will be moved over to daily.1, and a new snapshot will be stored in daily.0.  This will complete until you have 7 such daily directories, at which point the oldest will be deleted before the newest is created.  By using hard links, only if a file changes will it actually consume space on your hard drive.  Step two, complete!</p>

<h3>Step Three: Tie It All Together</h3>


<p>Now, for the easy part.  Let&#8217;s tell cron to perform a backup each night.  Create the file /etc/cron.daily/backupWebApps.sh, and put this text in there:</p>

<pre>
#!/bin/bash

WEBAPPS=( MySite_wp )

for WEBAPP in ${WEBAPPS[@]}; do
    /apps/scripts/backupMySQL.sh $WEBAPP
    /apps/scripts/rsyncBackup.sh /apps/$WEBAPP/ /apps/snapshots/$WEBAPP/
done
</pre>


<p>Now, run &#8216;chmod 755 /etc/cron.daily/backupWebApps.sh&#8217;, and you will have a backup of your MySite_wp applicaton!  What&#8217;s best, is let&#8217;s say you add a Drupal application, you name your MySQL database MySite_Drupal, and your document root is a /apps/MySite_Drupal.  All you need to do is change line 3 of backupWebApps.sh to look like this:</p>

<pre>
WEBAPPS=( MySite_wp MySite_Drupal )
</pre>


<p>and you will get a backup of your Drupal install the following night too!</p>

<h3>Restoration</h3>


<p>Heaven forbid, you&#8217;ve made a critical mistake, installed a bad plugin, or something else that&#8217;s horribly broken your MySite_wp install.  No fear!  Here&#8217;s how to restore it.</p>

<pre>
mkdir /apps/MySite_wp-broken && mv /apps/MySite_wp/* /apps/MySite_wp-broken/
rsync -avz /apps/snapshots/MySite_wp/daily.0/* /apps/MySite_wp/
gzip -dc /apps/mysqlbackups/archives/MySite_wp.sql.1.gz > /tmp/mysite.sql
mysql -u root -p MySite_wp < /tmp/mysite.sql
rm /tmp/mysite.sql
</pre>


<p>and viola!  Your site is back as it was at the time of the last backup.</p>

<h3>Offsite Backup</h3>


<p>To ensure safety, you should then backup your /apps/snapshots and your /apps/mysqlbackups directories to someplace offsite.  I recommend rsync for this as well.  Stay tuned for a post on how to do this!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2008/08/01/linode-review">Linode Review</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-08-01T00:00:00-05:00" pubdate data-updated="true">Aug 1<span>st</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I recently switched from
<a href="http://www.aplus.net" title="Aplus.net">Aplus.net</a> shared Unix hosting
to
<a href="http://www.linode.com/?r=c4f79463ba583ec1f15e3307190bda4bda9d65df" title="Linode">Linode</a>
Xen-based VPS hosting. Follow the jump to read my reviews of both.
I had a shared Unix account with Aplus.net for about a year. Aplus
used FreeBSD with jails to provide their shared hosting. While that
gave me the ability to ssh into the box, I could not get root. It
did however, work quite well - the control panel is nice, and you
could use about anything you wanted to. I never needed to use their
support, their control panel worked great, and I never had any
issues with billing. There were two drawbacks, one minor, the other
major:
1.  The box was firewalled to death. I&#8217;m all for firewalls, but I</p>

<pre><code>like to be in control of it. Not only were inbound ports blocked
(which is a good thing), but all outbound access was blocked as
well. This made hard things impossible, and easy things hard. For
example, adding a simple RSS widget to your page hosted on Aplus
just will not work.
</code></pre>

<ol>
<li>The particular box I was on was severely over-sold. I have no
idea how many shared accounts there were on the box, but there were
times where my simple little wordpress blog was completely
unavailable. $12 a month is cheap, but I at least expect to be able
to render pages!</li>
</ol>


<p>After doing a bunch of research, my choice for a new hosting
provider was down to
<a href="http://www.linode.com/?r=c4f79463ba583ec1f15e3307190bda4bda9d65df" title="Linode">Linode</a>
and <a href="http://www.slicehost.com" title="SliceHost">SliceHost</a>. In the end,
I settled on
<a href="http://www.linode.com/?r=c4f79463ba583ec1f15e3307190bda4bda9d65df" title="Linode">Linode</a>
because I was reading some grumblings that SliceHost was having
some growing pains, and I couldn&#8217;t find any negatives to
<a href="http://www.linode.com/?r=c4f79463ba583ec1f15e3307190bda4bda9d65df" title="Linode">Linode</a>.
So, at 10:57pm on July 30th, I started the sign up process for a
<a href="http://www.linode.com/?r=c4f79463ba583ec1f15e3307190bda4bda9d65df" title="Linode">Linode</a>
540 in their Dallas datacenter. At 11:07pm that night (10 minutes
later!) I had full access to my server. Very impressive! By 11pm on
July 31st, I had moved my blog from Aplus to
<a href="http://www.linode.com/?r=c4f79463ba583ec1f15e3307190bda4bda9d65df" title="Linode">Linode</a>
without any hitches. First, let me tell you what
<a href="http://www.linode.com/?r=c4f79463ba583ec1f15e3307190bda4bda9d65df" title="Linode">Linode</a>
is and isn&#8217;t.
-   <strong>Linode is</strong>a provider of Xen-based virtualized hosts. This</p>

<pre><code>means you get to pick which distribution you want, and you get your
own root account with which you can do what you feel like.
</code></pre>

<ul>
<li><strong>Linode provides</strong>a DNS Manager included with all their plans
that allows you have full control over any number of domains. I had
no idea this existed until I signed up, and it was a great little
side benefit. I was able to cancel my DNS service at a registrar
that I was paying $15 a year for.</li>
<li><strong>Linode provides</strong>you with a Xen instance with 4 cores of Xeon
for CPU, and a configurable amount of RAM, bandwidth, and storage.</li>
<li><strong>Linode provides</strong>a out-of-band management tool named lish
(LInode SHell) which gives you console level access to your
server.  There is also an AJAX web-based console interface
available.</li>
<li><strong>Linode provides</strong>you with everything you need to build your
own server. You may do with this server what you like, provided
it&#8217;s for law-abiding activities. You have the ability to create
your own partitions, upgrade your kernel, install packages,
whatever!</li>
<li><strong>Linode provides</strong>you with more than enough rope with which
you can hang yourself! This is a logical extension of the above
point. If you have root, you can most certainly do a &#8216;rm -rf /&#8217; and
no one will stop to ask you if you&#8217;re sure or not.</li>
<li><strong>Linode is not</strong>your run-of-the-mill webhoster. If you want to
run your own LAMP stack, you are more than welcome to do so.
However, <strong>you</strong>are responsible for the setup and maintanence of
the entire stack. There&#8217;s no cute little control panel button you
click to setup a blog. If you don&#8217;t know Linux, and don&#8217;t want to
learn how to do these sort of things, you&#8217;re better off with a
provider such as Aplus.net.</li>
</ul>


<p>After signing up, you get to pick which data center you want your
server to be hosted in.  Here are their current datacenters:
-   Newark, NJ
-   Atlanta, GA
-   Dallas, TX
-   Fremont, CA</p>

<p>You can view what servers are available in what datacenters
<a href="http://www.linode.com/avail.cfm?r=c4f79463ba583ec1f15e3307190bda4bda9d65df" title="Linode Datacenter Availability">here</a>.
Here are some of Linode&#8217;s support options:
-   A quick</p>

<pre><code>[FAQ](http://www.linode.com/faq.cfm?r=c4f79463ba583ec1f15e3307190bda4bda9d65df "FAQ")
</code></pre>

<ul>
<li>A
<a href="http://www.linode.com/wiki/?r=c4f79463ba583ec1f15e3307190bda4bda9d65df" title="Wiki">Wiki</a></li>
<li>A public
<a href="http://www.linode.com/forums/?r=c4f79463ba583ec1f15e3307190bda4bda9d65df">support forum</a>
which employees take part in regularly</li>
<li>An
<a href="http://www.linode.com/irc/?r=c4f79463ba583ec1f15e3307190bda4bda9d65df">IRC channel</a></li>
<li>A support ticket system for active customers</li>
<li>There is a phone number posted on their site, but I don&#8217;t think
it&#8217;s intended to be used for support issues.</li>
</ul>


<p>After just two days of running my own
<a href="http://www.linode.com/?r=c4f79463ba583ec1f15e3307190bda4bda9d65df" title="Linode">Linode</a>,
I must say that I&#8217;m thoroughly impressed. Uptime is 100%, and I
haven&#8217;t needed support for anything at all. My blog runs as it
should - and if it didn&#8217;t it would be my fault for not setting it
up properly. I will update this post in the future with more data
as I learn more about the service. Also, if you&#8217;d like to give
<a href="http://www.linode.com/?r=c4f79463ba583ec1f15e3307190bda4bda9d65df" title="Linode">Linode</a>
a try and have enjoyed this post, consider visiting their site by
clicking on any of the
<a href="http://www.linode.com/?r=c4f79463ba583ec1f15e3307190bda4bda9d65df" title="Linode">Linode</a>
links present in this post. They contain a referral code that will
give me $20 credit if you sign up and stay a customer for 30 days.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2008/07/21/using-suns-java-jdk-eclipse-ubuntu">Using Sun&#8217;s Java (Jdk) With Eclipse on Ubuntu</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-07-21T00:00:00-05:00" pubdate data-updated="true">Jul 21<span>st</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Let&#8217;s face it, if you&#8217;re reading this article, you know what
Eclipse is, and what you&#8217;re trying to do.  Follow the jump for how
to do it. First, install Sun&#8217;s Java 6 jdk, and Eclipse:</p>

<pre><code>sudo apt-get install eclipse sun-java6-jdk
</code></pre>

<p>Now, set up the newly installed jdk as the system default:</p>

<pre><code>sudo update-java-alternatives -s java-6-sun
</code></pre>

<p>Next, set your default jvm:</p>

<pre><code>sudo vim /etc/jvm
</code></pre>

<p>and add this line at the top of the file:</p>

<pre><code>/usr/lib/jvm/java-6-sun
</code></pre>

<p>Now, that should do the trick, but the Eclipse packaged with Ubuntu
is packaged to prefer GCJ.  Let&#8217;s fix that:</p>

<pre><code>sudo vim /etc/eclipse/java_home
</code></pre>

<p>and again add this line at the top of the file:</p>

<pre><code>/usr/lib/jvm/java-6-sun
</code></pre>

<p>Finally, while you&#8217;re at it, bump up your Xms here:</p>

<pre><code>sudo vim /usr/lib/eclipse/eclipse.ini
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2008/07/07/dnsmasq-dhclient">Dnsmasq + Dhclient</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-07-07T00:00:00-05:00" pubdate data-updated="true">Jul 7<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I needed to be able to use dnsmasq on my laptop so that I could
forward corporate hostname requests to our corporate DNS servers,
but send all other requests to OpenDNS&#8217; servers.  Sometimes at a
hotel, you can&#8217;t use OpenDNS, so I also wanted to fail back to
whatever DNS servers were being sent via DHCP. The trick here is to
get dhclient to update a file other than /etc/resolv.conf.  You
tell dhclient to update a file named /etc/resolv.conf.dhclient,
then point /etc/resolv.conf to use localhost.  Finally, tell
dnsmasq to use /etc/resolv.conf.dhclient as its source.  Here&#8217;s how
I did that on Ubuntu 8.04: First, install dnsmasq:</p>

<div>
  <pre><code class='console'>sudo apt-get install dnsmasq resolvconf</code></pre>
</div>


<p>Next, set the following in /etc/dnsmasq.conf:</p>

<pre><code>...
resolv-file=/etc/resolv.conf.dhclient
server=/mycorp.com/10.253.10.83
...
</code></pre>

<p>Then restart dnsmasq:</p>

<pre><code>sudo /etc/init.d/dnsmasq restart
</code></pre>

<p>Now, configure your local machine to use a hardcoded  DNS server of
127.0.0.1.  I use NetworkManager, so I left click on the NM icon,
and select &#8220;Manual configuration&#8230;&#8221;.  Click the DNS tab, then
click the unlock button.  Remove any existing servers in &#8220;DNS
Servers&#8221;, then add 127.0.0.1.  Optionally, add any search domains
you might want to use. Now, we need to tell dhclient to a) prepend
OpenDNS&#8217; servers to the nameserver list, and b) write the DNS
config to /etc/resolv.conf.dhclient instead of /etc/resolv.conf. 
First, edit /etc/dhcp3/dhclient.conf, and add the line:</p>

<pre><code>prepend domain-name-servers 208.67.222.222, 208.67.220.220;
</code></pre>

<p>Now, for the part that I couldn&#8217;t find using Google.  Let&#8217;s tell
dhclient to update a different file:</p>

<div>
  <pre><code class='console'>sudo cat   &gt; /etc/dhcp3/dhclient-enter-hooks.d/dnsmasq &lt;&lt;EOD
#!/bin/sh

CUSTOM_RESOLV_CONF=/etc/resolv.conf.dhclient

make_resolv_conf() {
  if [ -n &quot;$new_domain_name_servers&quot; ]; then
    /bin/rm $CUSTOM_RESOLV_CONF
    [ -n &quot;$new_domain_name&quot; ] &amp;&amp; echo search $new_domain_name &gt;$CUSTOM_RESOLV_CONF
    for nameserver in $new_domain_name_servers; do
      echo nameserver $nameserver &gt;&gt; $CUSTOM_RESOLV_CONF
    done
  fi
}
EOD</code></pre>
</div>


<p>Now, set it to be executable:</p>

<pre><code>sudo chmod 755 /etc/dhcp3/dhclient-enter-hooks.d/dnsmasq
</code></pre>

<p>Now, reboot.  When you reboot, you should have the following setup:
1.  When you get a DHCP lease, the new DNS config will be written</p>

<pre><code>to /etc/resolv.conf.dhclient
</code></pre>

<ol>
<li>This file will first contain the two OpenDNS servers, then
whatever the ISP/Router sends as nameservers</li>
<li>/etc/resolv.conf will point to localhost and should never
change.</li>
<li>Any requests for mycorp.com will go to the 10.x nameservers
above</li>
<li>Any requests for any other domains will first be tried through
OpenDNS, then through the ISP&#8217;s/Router&#8217;s nameservers.</li>
</ol>


<p>Hope this helps you as much as it helped me!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2008/05/08/subnet-routing-solaris-10-non-global-zones">Per-subnet Routing With Solaris 10 Non-global Zones</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-08T00:00:00-05:00" pubdate data-updated="true">May 8<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I had the chance to finally tinker with Solaris 10 zones the other day. They are impressive - very easy to setup! One of my biggest gripes about Solaris is that they&#8217;ve fallen way behind in the area of advanced IP routing. If you want to do things like policy routing in Solaris, you have to install ipfilter, which is no easy task. There is no alternative to iproute2 in Linux. Read after the jump to find a quick hack to setup proper routing for non-global zones on multiple subnets. <!--break--> <em>Update: If you are using Solaris 10 Update 4 or newer, you may be able to use </em><code>set ip-type=exclusive</code><em> in your zone config. This will give you what I&#8217;ve hacked together here. Note, that you must have a dedicated interface for the zone in order to use it, and there are some other limitations, <a href="http://docs.sun.com/app/docs/doc/817-1592/gepxo?l=en&amp;a=view">described here</a>. Keep an eye on <a href="http://opensolaris.org/os/project/crossbow/">project Crossbow</a>, which will hopefully make all of this go away.</em> In Solaris 10, you set the default gateway at boot time by using /etc/defaultrouter. You can add multiple default routes by adding multiple lines to that file. However, if you do that, the kernel will simply round-robin the packets between the gateways, which will light up any firewall like a Christmas tree. Imagine the following scenario: HostA is a Solaris 10 box with 4 bge interfaces. HostA&#8217;s IP address is 192.168.20.2/24 and is assigned to bge0. The router for the 192.168.20.0/24 subnet is at 192.168.20.1. HostB is a non-global zone residing on HostA, with an IP address of 192.168.30.2/24 and you&#8217;ve assigned it to bge1 via zonecfg. The router for the 192.168.30.0/24 subnet is at 192.168.30.1. Now, non-global zones don&#8217;t have their own kernel, they &#8220;share&#8221; with the global zone. IP routing is handled in the kernel, so the routing configuration for the non-global zone needs to be done in the global zone. The first trick here is to get bge1 to come up on bootup, but not assign it an IP. Do this as root on HostA to establish that:</p>


<pre># echo "0.0.0.0" &gt; /etc/hostname.bge1</pre>


<p>This will plumb and bring up the interface, but it will not be assigned an IP. Now, remember what I said about the kernel round-robin routing packets earlier? It will only do that <strong>if both gateways are reachable</strong>. So, the trick is to make HostB&#8217;s gateway unreachable from HostA, and HostA&#8217;s gateway unreachable from HostB. There&#8217;s a catch-22 here as well, you can only add a default route if the gateway is currently reachable. So how in the world do we get this to work??? With some nice hackery, of course! First, set HostB&#8217;s configuration so that it does not boot automatically. Don&#8217;t worry if you need this functionality, we&#8217;ve got a hack for that too:</p>


<pre>root@HostA # zonecfg -z HostB
zonecfg:HostB&gt; set autoboot=false
zonecfg:HostB&gt; verify
zonecfg:HostB&gt; commit
zonecfg:HostB&gt; exit</pre>


<p>Now, we are going to create our own init script that will bring up bge1 temporarily with HostB&#8217;s IP, set the default route, then remove that IP. By using HostB&#8217;s IP, we are allowed to set the route, but when we remove the interface, HostB&#8217;s gateway becomes unreachable from HostA. Finally, we boot HostB, which sees only the default route for it&#8217;s interface. Let&#8217;s setup that init script:</p>


<pre># cat &lt;&lt;EOD &gt; /etc/init.d/zoneboot
#!/usr/bin/sh

/usr/sbin/ifconfig bge1 addif 192.168.30.2/24 up
/usr/sbin/route add default 192.168.30.1
/usr/sbin/ifconfig bge1 removeif 192.168.30.2
/usr/sbin/zoneadm -z HostB boot
EOD

# ln -s /etc/init.d/zoneboot /etc/rc3.d/S99zoneboot</pre>


<p>You can of course modify this script to work with more interfaces and zones, but you get the idea. Now, reboot HostA. HostA&#8217;s routing table looks like so:</p>


<pre># netstat -rn

Routing Table: IPv4
  Destination           Gateway           Flags  Ref     Use     Interface
default              192.168.30.1          UG       1        119
default              192.168.20.1          UG       1        112
192.168.20.2         192.168.20.2          U        1         35 bge0
224.0.0.0            192.168.20.2          U        1          0 bge0
127.0.0.1            127.0.0.1             UH       4        113 lo0</pre>


<p>HostA has two default gateways, but only one of them is reachable. Bingo! HostB&#8217;s routing table looks like this:</p>


<pre>
Routing Table: IPv4
  Destination           Gateway           Flags  Ref     Use     Interface
default              192.168.30.1           UG      1        112
192.168.30.0         192.168.30.2           U       1         27 bge1:1
224.0.0.0            192.168.30.2           U       1          0 bge1:1
127.0.0.1            127.0.0.1              UH      4        108 lo0:2</pre>


<p>Success! Hope you found this helpful!</p>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2008/05/08/forcing-nic-speed-and-duplex-solaris-10">Forcing NIC Speed and Duplex on Solaris 10</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-08T00:00:00-05:00" pubdate data-updated="true">May 8<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>There are two ways to force duplex &amp; speed on a Solaris 10 box - via the
driver, and via ndd. First, via the driver: <div>
  <pre><code class='console'># cat
&lt;&lt;EOD &gt; /platform/<code>uname -i</code>/kernel/drv/bge.conf adv_autoneg_cap=0
adv_1000fdx_cap=0 adv_1000hdx_cap=0 adv_100fdx_cap=1 adv_100hdx_cap=0
adv_10fdx_cap=0 adv_10hdx_cap=0; EOD</code></pre>
</div>
 Note that this sets
all instances of bge to 100Mbit Full Duplex. If you wish to be more selective,
you can do this: <div>
  <pre><code class='console'># cat &lt; /etc/init.d/net-tune</p>

<h1>!/bin/sh # Force to 100FDX NIC=bge for i in 0 1 2 3; do /usr/sbin/ndd -set</h1>

<p>/dev/${NIC}${i} adv_1000fdx_cap 0 /usr/sbin/ndd -set /dev/${NIC}${i}
adv_1000hdx_cap 0 /usr/sbin/ndd -set /dev/${NIC}${i} adv_100fdx_cap 1
/usr/sbin/ndd -set /dev/${NIC}${i} adv_100hdx_cap 0 /usr/sbin/ndd -set
/dev/${NIC}${i} adv_10fdx_cap 0 /usr/sbin/ndd -set /dev/${NIC}${i}
adv_10hdx_cap 0 /usr/sbin/ndd -set /dev/${NIC}${i} adv_autoneg_cap 0 done EOD</p>

<h1>chmod 755 /etc/init.d/net-tune # ln -s /etc/init.d/net-tune /etc/rc2.d</h1>

<p>/S68net-tune</code></pre>
</div>
 You have to reboot for the kernel config file
to take effect, but you can run the net-tune script at any time to make it
work. You can change the 0 1 2 3 in the for do loop above to set the instances
you need.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2008/05/02/legend-micro">Legend Micro</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-02T00:00:00-05:00" pubdate data-updated="true">May 2<span>nd</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This issue did finally get resolved and Paypal didn&#8217;t need to step
in. I&#8217;m going to remove any editorial remarks, and just leave the
factual emails here. If you do have any problems, I would recommend
getting Simon involved, he was prompt and professional - Justin I
bought what was listed as a &#8220;Hauppage PVR-150 MCE PCI Card&#8221;, and
received something compeletely different. Below is a copy and paste
of all my communications with them. On 4/23, I sent my first email
to them: Dear legendmicro-wholesale, I just received my tuner card,
and it&#8217;s not as the auction implied. It is not compatible with with
the WinTV-PVR-150 MCE PCI #1042, it&#8217;s a completely different card
with different inputs, outputs and chipsets. I run MythTV on Linux,
and there are no drivers for this card. I would gladly exchange
this card for a &#8220;true&#8221; WinTV PVR 150. If you don&#8217;t have one, I will
need to get a refund. -techadvise Later, on 4/23, they responded
via eBay: We do not advertize this card as being Linux compatible.
If you would like to return this card: PLEASE CONTACT OUR CUSTOMER
SERVICE please use link below to file an RMA
http://www.legendmicro.com/return-auth.asp -legendmicro-wholesale
Okay, fair enough. I didn&#8217;t really go into all the details about
how their auction was completely incorrect. So, I did that next. On
4/24, I sent them this via eBay: Dear legendmicro-wholesale, I can
contact your customer service, but I don&#8217;t think you understand
just how incorrect your listing is. Here are the major points: -
The title reads &#8220;Hauppauge WinTV-PVR-150 MCE PCI Tuner Card&#8221;. This
card doesn&#8217;t have anything at all in common with a Hauppage card.
It is a Emuzed Maui I/II, and is described in detail here:
http://www.gossamer-threads.com/lists/ivtv/devel/14252. The auction
states the card has an FM Tuner, it does not. The auction says it
has a composite video input, and the card does not. These are just
the major points. I need to either have a card that fits the
auction description sent to me free of charge, or I can return this
card for a refund. I don&#8217;t think I should be responsible for paying
freight in either direction as I would not have bid on the auction
if the listing was correct. Please confirm that I will receive
either a replacement or a full refund. Justin -techadvise To which
they replied on 4/24: Dear techadvise, Justin, You will need to
contact customer service to proceed with the RMA. PLEASE CONTACT
OUR CUSTOMER SERVICE please use link below to file an RMA
http://www.legendmicro.com/return-auth.asp -legendmicro-wholesale
So, on 4/28, I send them this via eBay: Dear legendmicro-wholesale,
I contacted customer service on April 24th at 4:30, and still
haven&#8217;t heard back yet. If we don&#8217;t have a plan in place by
tomorrow at noon, I&#8217;m just going to start working with Paypal/Ebay
to get my money refunded. Justin -techadvise To which Legend Micro
replied on 4/28: Dear techadvise, PLEASE CONTACT OUR CUSTOMER
SERVICE please use link below to file an RMA
http://www.legendmicro.com/return-auth.asp -legendmicro-wholesale
Gosh, that looks a lot like their last message. So, I got a little
frustrated, and sent them this back via eBay on 4/28: Dear
legendmicro-wholesale, IF YOU READ MY PREVIOUS MESSAGE YOU WOULD
KNOW THAT I HAVE! Thanks for making my decision easy. Enjoy your
negative feedback. -techadvise To which they replied on 4/28: Dear
techadvise, RMAs are processed in the order that they are received.
Sometimes it can take up to 2 business days to process an RMA. If
you would like to talk to someone regarding your RMA, please call
customer service 800-935-9305 x3 -legendmicro-wholesale At this
point, I opened a case with Paypal. Here&#8217;s what I posted to Paypal
on 4/28 to initiate a dispute: I bid on and won eBay item
#260231153044 a “Hauppauge WinTV-PVR-150 MCE PCI Tuner Card”. What
I received was a TV tuner card, but nothing close to the
specifications set forth in the auction. The auction title reads
“Hauppauge WinTV-PVR-150 MCE PCI Tuner Card”. This card doesn’t
have anything at all in common with a Hauppage card. It is a Emuzed
Maui I/II which is a cheap knock-off of the Hauppage. The auction
states the card has an FM Tuner, it does not. The auction says it
has a composite video input, and the card does not. I have sent
email to the seller 4 times. Each time, he replies with the same
copy &amp; paste answer: &#8212; PLEASE CONTACT OUR CUSTOMER SERVICE please
use link below to file an RMA
http://www.legendmicro.com/return-auth.asp &#8212; When I go to the
above site, the RMA procedure states that I will be liable for S&amp;H,
which I don’t believe I should be. I emailed the customer service
address listed on his site on 4/24, and have yet to hear back. As I
have explained to the seller, I am willing to accept either a full
refund of $49 or a true Hauppage PVR-150 MCE PCI card. I will
gladly ship the seller’s card back to him at his expense.
Metaphorically speaking, I bid on an American sports car, and
recieved a British 4 door sedan with the steering wheel on the
opposite side. Sure, it’s a car, but it’s unusable to me, and
doesn’t even come close to matching the original description. On
4/29, the seller updated the Paypal case: dear customer, we
apologize for inconvinience,we never received the RMA request from
you, please close the dispute, you will be issued RMA # and
pre-paid shipping label and you will be refunded in full as soon as
we will get the product back in stock, for any questions, please
call our customer service 800-935-9305 ext 3-Kat, thank you
Immediately after receiving that message, I filled out the RMA form
on their site, and put Kat&#8217;s email above in the notes field. I
immediately got an autoreply stating that my request had been
received. On 4/30, I get this via my personal email account,
bypassing eBay and Paypal: Dear customer, we apologize for
inconvenience, we never received the RMA request from you, please
close the dispute, you will be issued RMA # and pre-paid shipping
label and you will be refunded in full as soon as we will get the
product back in stock, for any questions, please call our customer
service 800-935-9305 ext 3-Kat, thank you Thank You for Your
Business Kat (Customer service) @LegendMicro.com 30700 Carter
Street STE B Solon, Ohio 44139 440-776-8839 Direct Voice
800-935-9305 Ext. 3 440-498-0706 Fax LegendMicro.com On 4/30, I
replied back to Kat directly: Kat, My apologies, but since the
dispute seems to be my only way to get a quick response from your
company, I&#8217;m going to keep it open until the issue is resolved. I
never submitted an RMA request before, I simply emailed
service@legendmicro.com with questions that I never received a
response to. However, I did submit an RMA form last night, and got
an autoreply, but nothing else after that. My request number is
501014. Thanks, Justin On 5/1, I received this update to the Paypal
dispute case: please close dispute and call 800-935-9305 ext 3 On
5/1, I update the Paypal case with the recent communications, and
set forth an ultimatum: As I stated in my email to you yesterday, I
will not close this dispute until my dispute is resolved. It is
not. I have filled out your RMA form, and received a request number
of 501014. I have not received an RMA number, nor a pre-paid
shipping label. Since your priority seems to be getting me to close
this dispute without actually resolving the problem, I&#8217;m going to
mandate that all future communications take place through Paypal
for third-party documentation - I will not call you. Once I recieve
an RMA number and a prepaid shipping label, I will ship the part
back to you. Once my paypal account is refunded, I will close this
dispute. UNTIL THAT POINT IN TIME, I WILL NOT CLOSE THIS DISPUTE!
Please stop asking me to do so. We have 17 days to get this
resolved before I file a claim. I suggest you stop trying to get me
to close the dispute and get around to sending me that RMA number
and shipping label that you&#8217;ve been promising me for 3 days now.
Justin After updating the case, Kat emailed me at my personal email
account on 5/1: As soon as we will see the dispute closed, you will
be emailed RMA # along with prepaid shipping label and we do have
the right item in stock for you. Thank You for Your Business Kat
(Customer service) @LegendMicro.com 30700 Carter Street STE B
Solon, Ohio 44139 440-776-8839 Direct Voice 800-935-9305 Ext. 3
440-498-0706 Fax LegendMicro.com I updated the case with paypal
with this: Paypal, Kat from LegendMicro just emailed my personal
email account, disregarding my request to stop communicating &#8220;out
of band&#8221;. Directly quoting her entire email: &#8212;BEGIN QUOTE&#8212; As
soon as we will see the dispute closed, you will be emailed RMA #
along with prepaid shipping label and we do have the right item in
stock for you. Thank You for Your Business Kat (Customer service)
@LegendMicro.com 30700 Carter Street STE B Solon, Ohio 44139
440-776-8839 Direct Voice 800-935-9305 Ext. 3 440-498-0706 Fax
LegendMicro.com &#8212;END QUOTE&#8212; It is obvious to me that the seller
is not concerned with customer service, only with closing this
dispute. Probably so that they can string me along further without
a deadline hanging over them. It&#8217;s my opinion that I&#8217;ve done
everything I can to facilitate fair commerce between myself and the
seller, and that the seller has done nothing to try and resolve the
issue. To date, I have still never received an RMA number, nor a
shipping label. I give up. They have done nothing that I ask, and
really seem to want me to take this &#8220;offline&#8221;. My only recourse at
this point is to turn this over to Paypal as a claim. Paypal, I
have complete documentation of all email communications between the
seller and myself should you need it. Thanks, Justin I then
escalated the dispute to a claim with this comment: While the
seller will answer my emails, they will not give me an RMA number
or a shipping label. They continue to try and get me to close the
dispute without giving me any indications that they will follow
through with their statements. Shortly after posting this blog
entry, and giving negative feedback on the seller, I finally got an
RMA from them. There&#8217;s some semi-sensitive information in the
email, so I&#8217;ll refrain from posting it here. However, two things to
note: - The RMA reflects that the card is indeed an Emuzed card,
not a Hauppage. Did they know all along? - The RMA includes a
refund on my original shipping charge. This is good! However, I
didn&#8217;t get any notice of a shipping label to send the Emuzed card
back to them. So, I sent them an email asking about the freight to
them on 5/2: Thank you for the RMA number. Kat in customer service
promised me that I would receive a pre-paid shipping label to
return the part back to you. What is the status on that label?
Justin Also on 5/2, I received a reply from someone (judging from
the typing style, either Kat or the seller) to my personal email
account: Please Close the dispute and you will receive the shipping
label. I immediately replied: The dispute is closed it&#8217;s a claim
now. You can send me the shipping label, and I&#8217;ll stop the claim.
Or you can lose the claim, pay me my refund and have to deal with
Paypal marking you as a questionable merchant. Your choice. It&#8217;s
beyond the point of the money now, it&#8217;s the principle of the whole
thing. You guys didn&#8217;t do jack for me until I opened the claim.
Hell, I have a good reason to think that you knew you were selling
me something different than what I bid on. There&#8217;s no way I&#8217;m going
to give up the only leverage I have in exchange for your &#8220;word&#8221;
that you&#8217;ll get me a shipping label. You might like to know that
I&#8217;m tracking all of our communications via my blog so that Paypal
and other potential customers of yours can get a heads up on what
kind of shady practices you take part in.
http://techadvise.com/2008/05/02/legend-micro/ - I update it quite
regularly. Justin I received an email from Simon on 5/2: Justin,
First of all, I’d like to apologize on behalf of Legend Micro for
the miscommunication that occurred with this transaction. Second,
I’d like to give you this shipping label in hopes of resolving the
claim/dispute. Along with that, I’d like for you to consider
removing the negative feedback you left for us. I’d also like to
explain to you what happened in the misunderstanding: Our warehouse
mistakenly sent the wrong card. This is our mistake and you should
have been issued a shipping label from the beginning. We do have
the Hauppauge card that you originally ordered in stock. We would
be more than happy to send you the card that you originally bought
in exchange the card that was incorrectly shipped to you. Please
let me know if you would like the Hauppauge card or a full refund.
You can contact me directly at this email or by calling me at
either of the numbers below. Regards, Simon Legend Micro 30700
Carter Street Suite B Solon, Ohio 44139 Phone: 888-368-7573
Direct/International: 440-394-4570 To which I replied: Simon, THANK
YOU!!! This is all that I have wanted done since this issue was
started 11 days ago. I would love to get the proper card sent out.
Let&#8217;s do this - I will drop the original card off at the UPS store
with the label you have sent me. If you ship out the replacement
and supply me with the tracking number, I will close the Paypal
claim, and update my feedback on eBay. Let me know if this works
for you. Again, thank you for finally stepping up. Justin A few
minutes later Simon replied back: Justin, Sure this is not a
problem. We can ship out the card as soon as we see that the label
we sent you has been activated and the package is in UPS&#8217;
possession. Please let me know when you are planning on dropping
the card off at the UPS store. Regards, Simon I sent him the
following email: I will do this over my lunch break in the next
couple of hours. Simon and I emailed back and forth a few more
times, and they did what they promised. Once their tracking number
showed the package was in UPS&#8217; hands, I got a shipment notification
of the replacement card. On 5/7, I received my replacement which is
quite obviously a &#8220;true&#8221; Hauppage WinTV PCI card.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2007/11/09/combining-ipsec-dynamic-nat-and-static-nat-behind-cisco-ios-router">Combining IPSEC, Dynamic NAT, and Static NAT Behind a Cisco IOS Router</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-11-09T00:00:00-06:00" pubdate data-updated="true">Nov 9<span>th</span>, 2007</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Trying to combine IPSEC, dynamic NAT, &amp; static NAT on a Cisco router? Check
out <a href="http://www.cisco.com/en/US/tech/tk583/tk%0A372/technologies_configuration_example09186a0080094634.shtml">Cisco&#8217;s article on how to do it</a> first. If that
doesn&#8217;t work and you&#8217;re ready to drop kick the router out of the datacenter
like I was, put away your black belt for a few minutes, and read about how I
worked around a couple of bugs. Let&#8217;s define our problem first.</p>

<ul>
<li>You have two subnets connected via IPSEC VPN - for the purposes of this article, 192.168.10.0/24 and 192.168.11.0/24. We assume the VPN is already up and functional.</li>
<li>You want any host with an IP in the 192.168.11.0/24 subnet to have access to the Internet as well as access to the hosts on the other side of the IPSEC tunnel.</li>
<li><p>You have one host, in this case 192.168.11.5, that you want to have access to the 192.168.10.0/24 subnet, as well as have a static NAT&#8217;d IP address when accessing the Internet - in this case, 1.1.1.1.
It took me a couple days, and I still think there&#8217;s a bug in there somewhere,
but I did finally get it to work. The IOS I was using was 12.4(17). Now,
here&#8217;s my personal take on what I think happens that causes things to break.
Again, I worked on this for 2 days straight, so I&#8217;m a little blurry on
everything, but I do know that this method works. According to <a href="http://www.cisco.com/en/US/tech/tk583/tk372/technologies_configuration_exa%0Ample09186a0080094634.shtml"> Cisco&#8217;s artic
le</a>, you can get these results by simply using route-
maps on your static NAT commands. Almost, but not really. I found two other
requirements had to be in place before the NAT&#8217;s would work as they were
supposed to:</p></li>
<li><p>Only one route-map can be used in all of your NAT statements. I think this is a bug, as no one specifies this as being a rule, but I even went as far as to create two identical route-maps with different names, and set up two static NAT&#8217;s with each NAT rule using one route-map. This would not work until I set both static NAT rules to use the same route-map. The same goes for the dynamic NAT rule, which is why we use an access-list here.</p></li>
<li><p>Once you use a route-map in your static NAT&#8217;s, then the order in which the NAT statements are processed is reversed. Again, I think this is a bug. Basically, normal NAT rule processing dictates that the static NAT rules are evaluated before the dynamic ones. In my situation, this was true until I enabled the route-map option on the static NAT. If I eliminated the route-map option, the static NAT worked, but the host being static NAT&#8217;d could not access hosts on the other side of the VPN. Once I enabled the static NAT with the route-map option, I could access the hosts on the other side of the VPN, but was getting the dynamic NAT applied instead of the static NAT.
Step One: Configure Dynamic NAT We first need to setup an access list that
will:</p></li>
<li><p><strong>NOT NAT</strong> packets from our host that needs static NAT applied.</p></li>
<li><strong>NOT NAT</strong> packets that traverse the VPN.</li>
<li><p><strong>NAT</strong> packets from our 192.168.11.0/24 subnet to everywhere else.</p>

<p>ip access-list extended NoNat
 deny   ip host 192.168.11.5 any
 deny   ip 192.168.11.0 0.0.0.255 192.168.10.0 0.0.0.255
 permit ip 192.168.11.0 0.0.0.255 any</p></li>
</ul>


<p>Then, we use this command to setup dynamic NAT:</p>

<pre><code>ip nat inside source list NoNat interface GigabitEthernet0/0 overload
</code></pre>

<p>At this point, you should be able to access the Internet from any host with a
192.168.11.x address but not 192.168.11.5, as well as be able to access hosts
on the 192.168.10.0 subnet. Step Two: Setup Static NAT So, right now,
192.168.11.5 can access hosts across the tunnel, but not access anyplace on
the Internet. All other hosts on the 192.168.11.0/24 subnet can access both.
Again, according to the Cisco article above, we shouldn&#8217;t have to do this, but
I did. Since we have excluded our 192.168.11.5 host from being NAT&#8217;d at all,
we need to craft a route-map for him to be static NAT&#8217;d, but not NAT&#8217;d when
accessing the remote VPN hosts. This boils down to creating an ACL identical
to the one above minus one line:</p>

<pre><code>ip access-list extended NoNatStatic
 deny   ip 192.168.11.0 0.0.0.255 192.168.10.0 0.0.0.255
 permit ip 192.168.11.0 0.0.0.255 any
</code></pre>

<p>Now, create a route-map that points to this ACL:</p>

<pre><code>route-map nonat-static permit 10
 match ip address NoNatStatic
</code></pre>

<p>Finally, setup your static NAT rule:</p>

<pre><code>ip nat inside source static 192.168.11.5 1.1.1.1 route-map nonat-static
</code></pre>

<p>Finally, all your NAT rules should be working perfectly now. In order to add
new static NAT&#8217;s, you simply need to add the local IP address to the top of
the NoNat ACL, and then create a new static NAT rule the points to the same
route-map. Do not use a different route-map, or you will run into the bug
above. Let me re-iterate that Cisco&#8217;s article above is cleaner, and that I
tried other cleaner ways of implementing this setup. If you have the time, try
to get your setup working using the article above. However, if you can&#8217;t get
it to work, try my way and see if you get the results you&#8217;re looking for.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/13/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/11/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/content/using-git-submodules-dynamic-puppet-environments">Using Git Submodules with Dynamic Puppet Environments</a>
      </li>
    
      <li class="post">
        <a href="/content/2011/11/14/vpsnet-review">VPS.net review</a>
      </li>
    
      <li class="post">
        <a href="/content/2011/10/19/its-not-you-its-me-call-node-gallery-co-maintainers">It&#8217;s not you, it&#8217;s me: Call for Node Gallery co-maintainers</a>
      </li>
    
      <li class="post">
        <a href="/content/2011/09/20/drupal-heroku">Drupal on Heroku</a>
      </li>
    
      <li class="post">
        <a href="/content/2011/04/19/selecting-right-cdn-your-website">Selecting the right CDN for YOUR website</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/justintime">@justintime</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'justintime',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("justinellison", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/justinellison" class="twitter-follow-button" data-show-count="false">Follow @justinellison</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Justin Ellison -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sysadminsjourney';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
