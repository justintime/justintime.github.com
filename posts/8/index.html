
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>SysAdmin's Journey</title>
  <meta name="author" content="Justin Ellison">

  
  <meta name="description" content="Dangit, I knew I forgot something today!!! Today was the day that some very
&ldquo;in-the-know&rdquo; Sun engineers participated in an open chat &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sysadminsjourney.com/posts/8/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="SysAdmin's Journey" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-5430710-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">SysAdmin's Journey</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="sysadminsjourney.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/contact">Contact</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/05/28/transcript-opensolaris-chat-slashdot-morning">Transcript of OpenSolaris Chat on Slashdot This Morning</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2009-05-28T00:00:00-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2009</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Dangit, I knew I forgot something today!!! Today was the day that some very
&ldquo;in-the-know&rdquo; Sun engineers participated in an open chat about
<a href="http://www.opensolaris.org">OpenSolaris</a> on <a href="http://slashdot.org">Slashdot</a>.
For those of you like me who were too busy fighting fires to participate,
<a href="http://dlc.sun.com/osol/advocacy%0A/opensolaris-slashdot-session-28-05-2009.html">here is a link to the transcript</a>. I wish I could make it to
<a href="http://developers.sun.com/events/communityone/2009/west/ind%0Aex.jsp?intcmp=2706">CommuntyOne West</a> this year, but I found out about it too late. Anyone
going?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/05/28/nagios-checkdellwarranty-plugin-updated">Nagios Check_dell_warranty Plugin Updated</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2009-05-28T00:00:00-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2009</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It&rsquo;s been blogged about recently how cool the <a href="http://www.monitoringexchange.org/cgi-%0Abin/page.cgi?g=Detailed%2F3094.html;d=1">check_dell_warranty
plugin</a> by Erinn Looney-Triggs is. It solves
a very real problem for us - sometimes servers run so well you forget to make
sure that you renew your support contracts. However, it wasn&rsquo;t quite right for
us - we have some older Dells that have RHEL 4 with an older (incompatible)
python on them still. Also, the plugin wouldn&rsquo;t work without configuring sudo.
Well, like any other sysadmin would do, I fixed it!  With a very small amount
of code, I added the ability to specify the serial number on the command line
with a -s parameter. This gives you a lot of flexibility:</p>

<ul>
<li>It lets you run this plugin on older machines with older Python interpreters</li>
<li>It eliminates the dependency requiring a recent dmidecode</li>
<li>It eliminates the sudo dependency, no need to configure sudo</li>
<li>It gives you the ability to have your Nagios server check the warranty status on multiple hosts without using ssh/nrpe/etc.</li>
<li>If you don&rsquo;t use the -s flag, the plugin will function like before, using sudo and dmidecode to determine the service tag.
Erinn also found a bug at the same time I did where the check was working
properly, but it would never return a WARNING or CRITICAL state. It&rsquo;s fixed
now, so if you downloaded it before, make sure to get the most recent version.
Erinn was kind enough to include my changes in the main script, so <a href="http://www.monitoringexchange.org/cgi-%0Abin/page.cgi?g=Detailed%2F3094.html;d=1">go
download it</a>!</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/05/26/using-sun-storagetek-a1000-under-solaris-10">Using the Sun StorageTek A1000 Under Solaris 10</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2009-05-26T00:00:00-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2009</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>We have an old Sun StorageTek A1000 sitting around that we use as scratch
space for our Amanda backups. Sure, it&rsquo;s old and slow, but it works very well
for what we use it for. After upgrading to Solaris 10, the mountpoints worked,
but I was getting a lot of complaints when loading the rdriver module from the
Raid Manager application.  Upon reboot into Solaris 10, I got a huge amount of
these messages spewed to the console:</p>

<pre><code>May 21 23:24:47 myhost krtld: [ID 819705 kern.notice] /kernel/drv/sparcv9/rdriver: undefined symbol
May 21 23:24:47 myhost krtld: [ID 826211 kern.notice] 'dev_get_dev_info'
May 21 23:24:47 myhost krtld: [ID 472681 kern.notice] WARNING: mod_load: cannot load module 'rdriver'
May 21 23:24:47 myhost genunix: [ID 370176 kern.warning] WARNING: forceload of drv/rdriver failed
</code></pre>

<p>It turns out that the A1000 was EOL before the Solaris 10 release, so I guess
I can&rsquo;t blame Sun for that. But, thanks to <a href="http://forums.sun.com/thread.jspa?threadID=5095232">a post over on the Sun
forums</a>, everything still
works with some configuration. First, you need to tell the system not to load
the rdriver and rdnexus modules:</p>

<pre><code>rem_drv rdriver
rem_drv rdnexus
</code></pre>

<p>Next, you need to tell the software to not use the multipath features of the
driver (which the A1000 only has one controller, so multipathing is
impossible). Make a backup of /etc/osa/rmparams, then change these two lines:</p>

<pre><code>Rdac_SupportDisabled=FALSE
Rdac_SinglePathSupportDisabled=FALSE
</code></pre>

<p>to look like these two lines:</p>

<pre><code>Rdac_SupportDisabled=TRUE
Rdac_SinglePathSupportDisabled=TRUE
</code></pre>

<p>Reboot, and all is well!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/05/25/liveupgrade-solaris-9-solaris-10">LiveUpgrade From Solaris 9 to Solaris 10</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2009-05-25T00:00:00-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2009</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Here&rsquo;s how to leverage LiveUpgrade to safely upgrade from Solaris 9 to Solaris
10 using a spare disk. No data is ever deleted, and to roll back to Solaris 9,
all you need is one command and a reboot.  Let&rsquo;s continue on from the example
in <a href="http://www.sysadminsjourney.com/content/2009/05/21/unmirroring-raid-1%0A-root-volume-solaris">Unmirroring a RAID 1 Root Volume on
Solaris</a> - we have two disks, c1t0d0 and c1t1d0. c1t0d0 is our
Solaris 9 disk, c1t1d0 is our spare.</p>

<h3>Phase One: Prepare the Solaris 9 environment</h3>

<p>First, we need to prepare the Solaris 9 environment with some packages and
patches. First, check out <a href="http://sunsolve.sun.com/search/document.do?assetkey=1-61-206844-1">Sun&rsquo;s InfoDoc
206844</a> and
make sure you have all of the patches required installed. Next, for
LiveUpgrade to work properly, you need to install the LiveUpgrade packages
from your Solaris 10 install media to your Solaris 9 box. First, remove the
existing packages:</p>

<pre><code>pkgrm SUNWlucfg SUNWluu SUNWlur
</code></pre>

<p>Then, install the new packages from your Solaris 10 media (if you&rsquo;re using
CD&rsquo;s, it&rsquo;s on disc 2):</p>

<pre><code>cd $SOLARIS10MEDIA/Solaris_10/Tools/Installers
./liveupgrade20
</code></pre>

<p>Next, let&rsquo;s copy the disk label from c1t0d0 over to c1t1d0 giving us the exact
same disk layout on the new disk as the old disk:</p>

<pre><code>prtvtoc /dev/rdsk/c1t0d0s2 | fmthard -s - /dev/rdsk/c1t1d0s2
</code></pre>

<p>We now have all the prep work done for getting ready for our LiveUpgrade. Now,
we need to create our boot environment.</p>

<h3>Phase Two: Create the New Boot Environment</h3>

<p>First, let&rsquo;s make some assumptions. Since we&rsquo;re upgrading from Solaris 9 to
Solaris 10, we&rsquo;ll be upgrading from UFS to UFS file systems. Also, since we
are upgrading from one disk to another, we will copy all filesystems from
c1t0d0 to c1t1d0 - no filesystems will be shared. In order to create our new
boot environment, we will use the &lsquo;lucreate&rsquo; command. Let&rsquo;s define some
variables:</p>

<p><strong>Flag</strong>
<strong>Description</strong></p>

<p>-c
Sets the current boot environment name to this name. In this example, we use
Solaris9</p>

<p>-n
Sets the newly created environment&rsquo;s name to this name. In this example, we
use Solaris10</p>

<p>-m
The -m option is the most critical part of the lucreate command. It specifies
the filesystems in the new environment. To create more than one filesystem,
you use the -m flag more than once. By using different variations on the -m
flag, you can reorganize, resize, and merge filesystems, but that&rsquo;s beyond the
scope of this article. The value to the -m flag is:
<em>mountpoint:device:fs_options</em>. From the previous example in <a href="http://www.sysadminsjourney.com/content/2009/05/21/unmirroring-raid-1%0A-root-volume-solaris">Unmirroring a
RAID 1 Root Volume on
Solaris</a>, we have 5 filesystems: /, /usr/local/, /apps,
/export/home/, and swap.</p>

<p>Using the above options for our scenario, we end up with:</p>

<pre><code>lucreate -c Solaris9 -n Solaris10 -m /:/dev/dsk/c1t1d0s0:ufs -m -:/dev/dsk/c1t1d0s1:swap \
-m /usr/local:/dev/dsk/c1t1d0s3:ufs -m /export/home:/dev/dsk/c1t1d0s4:ufs \
-m /apps:/dev/dsk/c1t1d0s5:ufs
</code></pre>

<p>Depending on the number and size of files in your source boot environment,
this may take awhile. The lucreate process gives you output for each step,
letting you know what it&rsquo;s doing.</p>

<h3>Phase Three: Upgrade the New Boot Environment to Solaris 10</h3>

<p>Now that phase two is done, we have a bootable copy of our current Solaris 9
environment. Now, we need to apply the upgrade to Solaris 10 to our new boot
environment. For simplicity, I have an exported Solaris 10 install DVD
extracted on another server that I use the automounter to access. Now, we&rsquo;ll
run the &lsquo;luupgrade&rsquo; command and tell it to install the upgrade to the new boot
environment we just created:</p>

<pre><code>luupgrade -u -n Solaris10 -s /net/install.mydomain.com/export/jumpstart/install/sparc_10
</code></pre>

<p>Again, this will take some time, and the process will give you output as it
clicks along.</p>

<h3>Phase Four: Mark the New Boot Environment as Active and Boot Into It</h3>

<p>Now, our Solaris 10 boot environment actually has a copy of our Solaris 9
environment with the upgrade to Solaris 10 within it. To boot into that
environment, we need to mark it as active, and reboot. These instructions
cover SPARC machines, for x86/x64, see the Sun documents referred in the
summary of this article - there are a couple of differences. To make our new
boot environment active, we&rsquo;ll use the &lsquo;luactivate&rsquo; command:</p>

<pre><code>luactivate Solaris10
init 6
</code></pre>

<p>Tricky, huh? ;-) Should something not go completely right during the upgrade,
you can roll back to your previous boot environment simply by specifying
&lsquo;Solaris9&rsquo; for &lsquo;Solaris10&rsquo; in the above &lsquo;luactivate&rsquo; command. If something
really went wrong with the upgrade, and you didn&rsquo;t boot successfully, don&rsquo;t
worry. The &lsquo;luactivate&rsquo; command above should have given you some output that
you should copy/paste someplace. Here&rsquo;s an example:</p>

<pre><code>In case of a failure while booting to the target BE, the following process 
needs to be followed to fallback to the currently working boot environment:

1. Enter the PROM monitor (ok prompt).

2. Change the boot device back to the original boot environment by typing:

     setenv boot-device disk:a

3. Boot to the original boot environment by typing:

     boot
</code></pre>

<p>If that doesn&rsquo;t do it, see the Sun docs in the summary of this article, they
will coach you through booting off the CD/DVD and reactivating the old
environment.</p>

<h3>Summary</h3>

<p>As an admin coming from Linux, the LiveUpgrade suite is a breath of fresh air
for giving you an easy upgrade path that&rsquo;s just as easy to undo as it is to
do. We&rsquo;ve only begun to scratch the surface of what you can do with
LiveUpgrade. You can use it to migrate from a UFS root to a ZFS root, use it
to install and test patches, install Flash Archives with it, reconfigure and
resize partitions, and on and on. For a much more comprehensive look into what
all LiveUpgrade can do, check out the Solaris Live Upgrade and Upgrade
Planning guide on <a href="http://docs.sun.com">http://docs.sun.com</a> - the <a href="http://docs.sun.com/app/docs/doc/820-7013?l=en">current
release is for Solaris 5/09</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/05/21/unmirroring-raid-1-root-volume-solaris">Unmirroring a RAID 1 Root Volume on Solaris</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2009-05-21T00:00:00-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2009</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It happens fairly often that you need to create a software mirror using SVM on
Solaris. A smaller percentage of the time, you need to create a SVM mirror of
your root partition. It doesn&rsquo;t happen very often at all, but there are cases
where you want to <em>unmirror</em> your root partition on Solaris. I&rsquo;ll get into the
why later, follow the jump for the howto.  First, we need to define the disk
setup of our server. The following table shows the current SVM setup.</p>

<p><strong>Mount Point</strong>
<strong>Mirror Device</strong>
<strong>c1t0d0 Slice/Submirror</strong>
<strong>c1t1d0 Slice/Submirror</strong></p>

<p>/</p>

<p>d1</p>

<p>slice 0/d10</p>

<p>slice 0/d11</p>

<p>/usr/local</p>

<p>d2</p>

<p>slice 3/d20</p>

<p>slice 3/d21</p>

<p>/export/home</p>

<p>d3</p>

<p>slice 4/d30</p>

<p>slice 4/d31</p>

<p>/apps</p>

<p>d4</p>

<p>slice 5/d40</p>

<p>slice 5/d41</p>

<p>swap</p>

<p>d5</p>

<p>slice 1/d50</p>

<p>slice 1/d51</p>

<p>-
MetaDB Slices</p>

<p>slice 6</p>

<p>slice 6</p>

<p>As you can see, we have 5 individual mirrors, one of which is for swap. I
don&rsquo;t recommend mirroring swap, but I include it here because there is an
important caveat you need to catch if you do have mirrored swap. We have two
disks: c1t0d0, and c1t1d0. We have the metadb&rsquo;s stored on slice 6 of each
disk. Our end goal is to boot from c1t0d0, and have c1t1d0 available for
whatever we like.</p>

<h2>Disclaimer</h2>

<p>I used these instructions, and they worked great for me. I&rsquo;ve used them on
both Solaris 9 and Solaris 10. If you embark on such a task, make sure to have
a complete, full backup before you proceed!</p>

<h2>Step One: Detach Submirrors</h2>

<p>First, we need to &ldquo;break&rdquo; the mirror, by removing all of the submirrors that
are contained on c1t1d0. In our case, we have mirrors 1-5, and the submirror
contained on c1t1d0 is always the same as the mirror device with a trailing 1.
This makes for a nice one liner:</p>

<pre><code>for i in 1 2 3 4 5; do metadetach d${i} d${i}1; done
</code></pre>

<p>This code removes submirror 11 from mirror 1, submirror 21 from mirror 2, and
so on.</p>

<h2>Step Two: de-metaroot</h2>

<p>The proper way to create a mirrored root volume is to use the metaroot tool to
modify /etc/vfstab and /etc/system for you. The good thing about this is that
you can use the same tool to to de-configure it too. Keeping in mind that we
want our root slice to be c1t0d0s0, we run:</p>

<pre><code>metaroot /dev/dsk/c1t0d0s0
</code></pre>

<h2>Step Three: Update vfstab</h2>

<p>Now, we need to edit /etc/vfstab and replace all of the mirror device mounts
with their c1t0d0 counterparts. If your original vfstab looked like this:</p>

<pre><code>...
/dev/md/dsk/d5  -       -       swap    -       no      -
/dev/dsk/c1t0d0s0  /dev/rdsk/c1t0d0s0 /       ufs     1       no      -
/dev/md/dsk/d4  /dev/md/rdsk/d4 /apps   ufs     2       yes     -
/dev/md/dsk/d3  /dev/md/rdsk/d3 /export/home    ufs     2       yes     -
/dev/md/dsk/d2  /dev/md/rdsk/d2 /usr/local      ufs     2       yes     -
...
</code></pre>

<p>Then your new vfstab should look something like this:</p>

<pre><code>...
/dev/dsk/c1t0d0s1       -       -       swap    -       no      -
/dev/dsk/c1t0d0s0  /dev/rdsk/c1t0d0s0 /       ufs     1       no      -
/dev/dsk/c1t0d0s5  /dev/rdsk/c1t0d0s5 /apps   ufs     2       yes     -
/dev/dsk/c1t0d0s4  /dev/rdsk/c1t0d0s4 /export/home    ufs     2       yes     -
/dev/dsk/c1t0d0s3  /dev/rdsk/c1t0d0s3 /usr/local      ufs     2       yes     -
...
</code></pre>

<h2>Step Four: Configure your Dump Device</h2>

<p>Here&rsquo;s the caveat for mirrored swap - you&rsquo;re probably using /dev/md/dsk/d5 for
your dump device. Let&rsquo;s fix that now. First run</p>

<pre><code>dumpadm | grep '/md/'
</code></pre>

<p>If that returns any output, then run this (using your single-disk slice for
swap):</p>

<pre><code>dumpadm -s /var/crash/`hostname` -d /dev/dsk/c0t0d0s1
</code></pre>

<h2>Step Five: Reboot and Verify</h2>

<p>Cross your fingers, and do a</p>

<pre><code>init 6
</code></pre>

<p>Once you&rsquo;re back up, look at the output of</p>

<pre><code>df -h &amp;&amp; swap -l
</code></pre>

<p>and make sure there&rsquo;s no references to any &lsquo;md&rsquo; devices.</p>

<h2>Step Six: Remove the Mirrors, Remaining Submirrors, and MetaDB&rsquo;s</h2>

<p>Now that we are running in a single disk environment, we need to remove the
mirrors and submirrors. Again, ripe for a one-liner:</p>

<pre><code>for i in 1 2 3 4 5; do metaclear -r d${i}; done
</code></pre>

<p>At this point, &lsquo;metastat&rsquo; should return no mirrors. Now, we can remove the
metadb&rsquo;s from slice 6 on both disks. Only do this if you&rsquo;re not using SVM for
anything else!</p>

<pre><code>metadb -df /dev/dsk/c1t1d0s6
metadb -df /dev/dsk/c1t0d0s6
</code></pre>

<h2>Summary</h2>

<p>Well, that covers the entire process. You should now have a free disk that you
can use for whatever you like!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/05/19/wtf-are-you-doing-your-keyboard">WTF Are You Doing to Your Keyboard?</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2009-05-19T00:00:00-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2009</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So, I have yet to upgrade my laptop to Ubuntu Jaunty, but I saw <a href="http://lifehacker.com/5259425/re+enable-ctrl%252Balt%252Bbackspace-%0Afor-ubuntu-904">this article
on how to re-enable Ctrl+Alt+Backspace in
Jaunty</a> come through my feed reader. A little more research dug up
this <a href="https://wiki.ubuntu.com/X/Config/DontZap">Ubuntu Wiki entry</a>
proclaiming: a number of users have complained about accidentally restarting
their X-Server Now, maybe I&rsquo;m getting old, but I can&rsquo;t tell you how many times
I&rsquo;ve been saved a reboot by that handy Ctrl+Alt+Backspace shortcut. My rant?
What in the hell are you trying to do that you &ldquo;accidentally kill X&rdquo; by
happening upon hitting that key combination? Was it really <strong>so</strong> many people
that you had to kill the shortcut for <strong>everyone</strong>? There is a line that can
be crossed when listening to your users, and I think Ubuntu has just crossed
it. What are your thoughts?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/05/18/breaking-bad-habits-dont-use-seq-your-shell-scripts">Breaking Bad Habits - Don't Use Seq in Your Shell Scripts</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2009-05-18T00:00:00-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2009</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Like most, I learned shell scripting by following examples. Well,
unfortunately, most of the samples I learned from used the &lsquo;seq&rsquo; binary to
execute a simple for loop like so:</p>

<pre><code>for i in `seq 1 10`; do
echo $i
done
</code></pre>

<p>I discovered why this is bad today - not all Unixes (Solaris and Darwin
included) come with it. Not to mention we&rsquo;re forking a process where we don&rsquo;t
need it. On bash, use the built-in brace expansion instead:</p>

<pre><code>for i in {1..10}; do
echo $i
done
</code></pre>

<p>For ksh and other shells, instead of using a for, use a while loop with an
incrementing counter if the integers are too numerous to list in the loop
header itself.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/05/12/nagios-fork-did-two-wrongs-make-right">The Nagios Fork: Did Two Wrongs Make a Right???</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2009-05-12T00:00:00-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2009</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It&rsquo;s an item that I feel hasn&rsquo;t got much press, at least in the limited RSS
entries I&rsquo;ve had time to scan lately: <a href="http://www.icinga.org/">Nagios has been
forked</a>. I&rsquo;ve been using Nagios long enough that I
actually used NetSaint for a bit, so I have some mixed feelings about Icinga.
In general, I&rsquo;m all for forks when they are indeed needed -
<a href="http://foswiki.org/">FOSWiki</a> is a great example. But forks shouldn&rsquo;t be
taken lightly, in many ways they are like a divorce - they should be a last
resort, not a quick way out. Personally, I think that the fork will ultimately
either fail or merge back into Nagios, but read on for why I think the Icinga
fork is a case of two wrongs making a right.  First, let me state that this is
all my personal opinion. I&rsquo;ve been around Nagios for a long time, and while I
don&rsquo;t know the developers involved personally, I&rsquo;ve read enough of all of
their emails over the years to have a good feel for what they are about. All
this seems to have come about because of a few reasons:</p>

<ul>
<li>Ethan Galstad, the sole person with commit access to Nagios, has become a bottleneck in the project. It took forever for Nagios 3.0 to come about, and development has slowed even more since then.</li>
<li>People seem to fear the commercialization of Nagios. Ethan&rsquo;s involvement in Nagios Enterprises appears to make some people nervous. I think this is all FUD - there&rsquo;s many examples of commercial OSS out there, and many of them are perfectly community-friendly. If Ethan finally wants to make some money over what he&rsquo;s developed over the past 10 years, then more power to him. If he and his company were to become &ldquo;evil&rdquo;, <strong>then</strong> you fork the code, but not before.</li>
<li><p>Ethan, like most developers, prioritized bugs and features based upon what he felt like working on the most. This lead many to feel that their requests were going unheard.
Netways is the company that is sponsoring the fork, they are all great coders,
and have committed a lot of their resources to Nagios. However, I feel they
made a critical mistake - they treated the fork like a coup or a crusade.
Ethan states that he was never directly approached about the fork before the
announcement &ldquo;Nagios is dead! Long live Icinga&rdquo; was made on the mailing list.
Part of OSS is open communication, I think that Netways should have tried to
discuss things first. Going back to the divorce analogy, they filed for
divorce before the spouse knew there was a problem. So, the title makes
reference to two wrongs and a right. I think this may actually be one of the
rare occasions where two wrongs do make a right. The two wrongs? Easy!</p></li>
<li><p>Ethan was wrong for taking the community too lightly, and not allowing the community to have more input into the direction of Nagios. He had far too little participation in the mailing lists to be the sole dictator of the code base.</p></li>
<li>Netways was wrong starting a fork for the wrong reasons. Don&rsquo;t misunderstand me here, I think nearly all of their reasons are valid, I just don&rsquo;t think that a fork should have been the first step to resolve them.
So, what&rsquo;s the right here? Well, it appears as though this may have been the
wake up call that Ethan may have needed. I encourage you to <a href="http://community.nagios.org/">read all of
Ethan&rsquo;s posts on his blog</a>, but he is already
taking steps to resolve some of the more obvious issues. First and foremost,
he&rsquo;s appointed Ton Voon and Andreas Ericsson to be core developers. Ton and
Andreas are excellent developers, and likely have committed more of their time
to the development and support of Nagios and it&rsquo;s plugins than Ethan himself
has over the last couple years. The project could not be in more competent
hands than in theirs. He has committed to the setup of a bug/issue/request
tracker for Nagios, and has <a href="http://ideas.nagios.org/">created a site that allows end-users to vote on
what features they want to see in Nagios</a>.
Unfortunately, my crystal ball tells me that Icinga will be a casualty, but it
has already served it&rsquo;s purpose without a single release - it has pushed
Nagios further in a few weeks than anything else has in the past few years.
Perhaps two wrongs did make a right? <strong>Personal note:</strong> this is the first big
opinion story I&rsquo;ve ever written here, and it feels odd. Usually I reserve
space on my blog for howto&rsquo;s and other facts instead of opinion. However,
Nagios has done so much for me over the years, it&rsquo;s hard not to voice my
opinion on a piece of software that I truly consider the single most important
piece of software I&rsquo;ve ever used in my role as a sysadmin. More than likely if
you&rsquo;ve read this far, you&rsquo;re a sysadmin too and likely have some strong
opinions on this topic - please do share them!</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/05/12/smf-manifests-endeca-iap-6x">SMF Manifests for Endeca IAP 6.x</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2009-05-12T00:00:00-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2009</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In doing some recent upgrades, we migrated our Endeca installation to Solaris
10. I got the itch to write some SMF manifests, and here&rsquo;s my completed XML
and method files.  First, download
<a href="/sites/sysadminsjourney.com/files/code/EndecaSMF.tar.gz">EndecaSMF.tar.gz</a>,
and extract it somewhere. Change to the ./endeca/ directory. Next you need to
edit a few things in the two xml files. If you&rsquo;re running the daemons under a
user other than &lsquo;endeca&rsquo;, edit the following lines updating it with the user
you created. Note that you have to edit both the start and the stop methods
for a total of eight changes (4 in each XML file):</p>

<pre><code>&lt;method_credential user="endeca"/&gt;
&lt;envvar name="USER" value="endeca"/&gt;
</code></pre>

<p>Next, edit the path to your Endeca installation. The XML files come
preconfigured with &lsquo;/apps/endeca&rsquo;. This is the value to &lsquo;&ndash;target=&rsquo; you used
in the setup shell scripts. If you used something other than &lsquo;/apps/endeca&rsquo;,
then do a search and replace through both XML files. Now, run the following as
root:</p>

<pre><code>cp svc-endeca* /lib/svc/method/
chown root:bin /lib/svc/method/svc-endeca*
chmod 755 /lib/svc/method/svc-endeca*
svccfg -v import endeca-eac.xml 
svccfg -v import endeca-workbench.xml
</code></pre>

<p>If your Endeca services are running, stop them now. To start the Endeca
Application Controller (HTTP Service), run:</p>

<pre><code>svcadm enable endeca/application-controller
</code></pre>

<p>If you want the Workbench server to start on every boot, run</p>

<pre><code>svcadm enable endeca/workbench
</code></pre>

<p>That&rsquo;s it!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/content/2009/05/07/installing-nrpe-212-source-smf-managed-service-solaris-10">Installing NRPE 2.12 From Source as a SMF Managed Service in Solaris 10</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2009-05-07T00:00:00-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2009</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Installing NRPE on Solaris 10 involves just a bit more than your normal './configure &amp;&amp; make &amp;&amp; make install' routine. However, all the dependencies are likely present on a freshly installed system, you just have to tell NRPE where to find it. There's one file you need to patch, and then it will install. From there it's easy to plug into SMF! <!--break--> First, let's make sure some directories are present, and create our Nagios user:</p>


<pre># mkdir /usr/local
# groupadd nagios
# useradd -m -c "nagios system user" -d /usr/local/nagios -g nagios -m nagios
</pre>


<p>Next, download and extract the source code to NRPE:</p>


<pre>$ cd /tmp/
$ /usr/sfw/bin/wget http://superb-east.dl.sourceforge.net/sourceforge/nagios/nrpe-2.12.tar.gz
$ gzip -dc nrpe-2.12.tar.gz | tar -xvf -
$ cd nrpe-2.12
</pre>


<p>Now, we need to tell the configure script where to find the openssl libraries, and make sure that GCC is in our path:</p>


<pre>$ PATH=$PATH:/usr/sfw/bin:/usr/ccs/bin ./configure --with-ssl=/usr/sfw/ --with-ssl-lib=/usr/sfw/lib/
</pre>


<p>That should run just fine. Before we build, we need to apply a quick fix to nrpe.c. If you don't do this, you'll get an error from make that says "nrpe.c:617: error: 'LOG_AUTHPRIV' undeclared (first use in this function)".</p>


<pre>$ perl -pi -e 's/LOG_AUTHPRIV/LOG_AUTH/; s/LOG_FTP/LOG_DAEMON/' src/nrpe.c
</pre>


<p>Now, we should be okay to build it:</p>


<pre>$ PATH=$PATH:/usr/sfw/bin:/usr/ccs/bin make 
</pre>


<p>Then, install it as root:</p>


<pre># PATH=$PATH:/usr/sfw/bin:/usr/ccs/bin make install
</pre>


<p>Either copy the nrpe.cfg sample included in the source code, or drop your own into /usr/local/nagios/etc/nrpe.cfg. Now, stay logged in as root for the following, now we'll get NRPE setup to run under SMF. First, we need to setup the service and present it to inetd:</p>


<pre>echo "nrpe 5666/tcp # NRPE" &gt;&gt; /etc/services
echo "nrpe stream tcp nowait nagios /usr/sfw/sbin/tcpd /usr/local/nagios/bin/nrpe \
 -c /usr/local/nagios/etc/nrpe.cfg -i" &gt;&gt; /etc/inet/inetd.conf
</pre>


<p>Now, tell SMF to pull in the inetd config:</p>


<pre>inetconv
</pre>


<p>At this point, the SMF service is available, but we want to use TCP wrappers so that only our Nagios server can talk to NRPE (substitute $NAGIOS_IP with the IP of your Nagios server):</p>


<pre>inetadm -m svc:/network/nrpe/tcp:default tcp_wrappers=TRUE
echo "nrpe: LOCAL, $NAGIOS_IP" &gt;&gt; /etc/hosts.allow
echo "nrpe: ALL" &gt;&gt; /etc/hosts.deny
</pre>


<p>Finally, fire up the service:</p>


<pre>svcadm enable nrpe/tcp
</pre>


<p>That's it! Nagios should be able to monitor your Solaris 10 box now. Someday, I'll make a package for this, but you can pretty well copy and paste the code here to get up and running.</p>



</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/9">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/7">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Default -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9978053499043694"
     data-ad-slot="5667084961"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/10/30/replicating-hashicorp-vault-in-a-multi-datacenter-setup/">Replicating Hashicorp Vault in a Multi-DataCenter Setup</a>
      </li>
    
      <li class="post">
        <a href="/content/using-git-submodules-dynamic-puppet-environments">Using Git Submodules With Dynamic Puppet Environments</a>
      </li>
    
      <li class="post">
        <a href="/content/2011/11/14/vpsnet-review">VPS.net Review</a>
      </li>
    
      <li class="post">
        <a href="/content/2011/10/19/its-not-you-its-me-call-node-gallery-co-maintainers">It's Not You, It's Me: Call for Node Gallery Co-maintainers</a>
      </li>
    
      <li class="post">
        <a href="/content/2011/09/20/drupal-heroku">Drupal on Heroku</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/justintime">@justintime</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'justintime',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("justinellison", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/justinellison" class="twitter-follow-button" data-show-count="false">Follow @justinellison</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Justin Ellison -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sysadminsjourney';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
